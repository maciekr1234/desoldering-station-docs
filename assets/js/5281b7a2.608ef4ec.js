"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[2443],{10936:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"architecture","title":"Architecture","description":"The desoldering station firmware follows a layered architecture designed for maintainability and clear separation of concerns.","source":"@site/docs/architecture.md","sourceDirName":".","slug":"/architecture","permalink":"/desoldering-station-docs/docs/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/maciekr1234/desoldering-station/tree/master/docs-site/docs/architecture.md","tags":[],"version":"current","lastUpdatedAt":1764953489000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Introduction","permalink":"/desoldering-station-docs/docs/intro"},"next":{"title":"Configuration","permalink":"/desoldering-station-docs/docs/configuration"}}');var i=t(74848),a=t(28453);const s={sidebar_position:2},l="Architecture",o={},d=[{value:"System Layers",id:"system-layers",level:2},{value:"Data Flow",id:"data-flow",level:2},{value:"Temperature Control Loop",id:"temperature-control-loop",level:3},{value:"Pump Trigger Flow",id:"pump-trigger-flow",level:3},{value:"State Machines",id:"state-machines",level:2},{value:"Heater State Machine",id:"heater-state-machine",level:3},{value:"Pump Debounce State Machine",id:"pump-debounce-state-machine",level:3},{value:"Memory Layout",id:"memory-layout",level:2},{value:"FreeRTOS Tasks",id:"freertos-tasks",level:2},{value:"Module Dependencies",id:"module-dependencies",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",mermaid:"mermaid",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,i.jsxs)(n.p,{children:["The desoldering station firmware follows a ",(0,i.jsx)(n.strong,{children:"layered architecture"})," designed for maintainability and clear separation of concerns."]}),"\n",(0,i.jsx)(n.h2,{id:"system-layers",children:"System Layers"}),"\n",(0,i.jsx)(n.mermaid,{value:'graph TB\n    subgraph GUI["\ud83d\udda5\ufe0f GUI Layer"]\n        direction LR\n        MainScreen["Main Screen<br/><small>Temperature display</small>"]\n        SettingsMenu["Settings Menu<br/><small>Configuration UI</small>"]\n        Styles["Styles<br/><small>Theme system</small>"]\n        Global["Global State<br/><small>lv_subject bindings</small>"]\n    end\n    \n    subgraph App["\u2699\ufe0f Application Layer"]\n        direction LR\n        Heater["HeaterController<br/><small>PID control, state machine</small>"]\n        Pump["PumpController<br/><small>Motor, trigger debounce</small>"]\n        Settings["Settings<br/><small>gSettings, persistence</small>"]\n        Tasks["FreeRTOS Tasks<br/><small>Scheduling</small>"]\n    end\n    \n    subgraph Driver["\ud83d\udd27 Driver Layer"]\n        direction LR\n        PID["PID"]\n        Motor["MotorDriver"]\n        Encoder["Encoder"]\n        Temp["Temperature"]\n        Motion["Motion Sensor"]\n        PWM["PWM"]\n        ADC["ADC"]\n    end\n    \n    subgraph HAL["\ud83d\udce6 SDK / HAL Layer"]\n        direction LR\n        Arduino["Arduino Core"]\n        PicoSDK["Pico SDK"]\n        RTOS["FreeRTOS"]\n        LittleFS["LittleFS"]\n    end\n    \n    subgraph HW["\ud83d\udd0c Hardware Layer"]\n        direction LR\n        ADCPeriph["ADC<br/><small>12-bit</small>"]\n        PWMPeriph["PWM<br/><small>8 slices</small>"]\n        GPIO["GPIO<br/><small>30 pins</small>"]\n        SPI["SPI<br/><small>Display</small>"]\n        Flash["Flash<br/><small>2MB</small>"]\n    end\n    \n    GUI --\x3e App\n    App --\x3e Driver\n    Driver --\x3e HAL\n    HAL --\x3e HW\n    \n    style GUI fill:#553c9a,stroke:#805ad5\n    style App fill:#2c5282,stroke:#4299e1\n    style Driver fill:#276749,stroke:#48bb78\n    style HAL fill:#744210,stroke:#ed8936\n    style HW fill:#742a2a,stroke:#fc8181'}),"\n",(0,i.jsx)(n.h2,{id:"data-flow",children:"Data Flow"}),"\n",(0,i.jsx)(n.h3,{id:"temperature-control-loop",children:"Temperature Control Loop"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant ADC\n    participant Temp as Temperature Driver\n    participant Heater as HeaterController\n    participant PID\n    participant PWM\n    participant UI as LVGL UI\n    \n    loop Every 50ms\n        ADC->>Temp: Raw ADC value\n        Temp->>Heater: Temperature \xb0C\n        Heater->>PID: Current vs Target\n        PID->>Heater: Output (0-100%)\n        Heater->>PWM: Set duty cycle\n        Heater->>UI: Update display\n    end"}),"\n",(0,i.jsx)(n.h3,{id:"pump-trigger-flow",children:"Pump Trigger Flow"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant GPIO as Trigger GPIO\n    participant Pump as PumpController\n    participant Debounce as Debounce FSM\n    participant Motor as MotorDriver\n    \n    GPIO->>Pump: IRQ (falling edge)\n    Pump->>Debounce: Start debounce\n    Note over Debounce: Wait 50ms\n    Debounce->>Pump: Confirmed press\n    Pump->>Motor: Start motor\n    \n    GPIO->>Pump: IRQ (rising edge)\n    Pump->>Debounce: Start release debounce\n    Note over Debounce: Wait 50ms\n    Debounce->>Pump: Confirmed release\n    Pump->>Motor: Stop motor"}),"\n",(0,i.jsx)(n.h2,{id:"state-machines",children:"State Machines"}),"\n",(0,i.jsx)(n.h3,{id:"heater-state-machine",children:"Heater State Machine"}),"\n",(0,i.jsx)(n.mermaid,{value:"stateDiagram-v2\n    [*] --\x3e Off: init\n    \n    Off --\x3e Running: start()\n    Running --\x3e Off: stop()\n    \n    Running --\x3e Standby: timeout\n    Standby --\x3e Running: trigger\n    \n    Standby --\x3e Sleep: timeout\n    Sleep --\x3e Standby: motion\n    Sleep --\x3e Off: long timeout\n    \n    Off --\x3e Tuning: tune_start\n    Tuning --\x3e Off: tune_done\n    \n    Running --\x3e Error: sensor fault\n    Standby --\x3e Error: sensor fault\n    Error --\x3e Off: error_clear\n    \n    state Running {\n        [*] --\x3e PIDActive\n        PIDActive: PID controlling temperature\n    }\n    \n    state Error {\n        [*] --\x3e SafeMode\n        SafeMode: PWM = 0%, heater disabled\n    }"}),"\n",(0,i.jsx)(n.h3,{id:"pump-debounce-state-machine",children:"Pump Debounce State Machine"}),"\n",(0,i.jsx)(n.mermaid,{value:"stateDiagram-v2\n    [*] --\x3e IDLE\n    \n    IDLE --\x3e DEBOUNCING: trigger \u2193 (falling edge)\n    DEBOUNCING --\x3e STABLE: timeout (still pressed)\n    DEBOUNCING --\x3e IDLE: trigger \u2191 (bounce)\n    \n    STABLE --\x3e DEBOUNCING_RELEASE: trigger \u2191 (rising edge)\n    DEBOUNCING_RELEASE --\x3e IDLE: timeout (still released)\n    DEBOUNCING_RELEASE --\x3e STABLE: trigger \u2193 (bounce)\n    \n    state IDLE {\n        [*] --\x3e Waiting\n        Waiting: Motor OFF\n    }\n    \n    state STABLE {\n        [*] --\x3e Active\n        Active: Motor ON\n    }"}),"\n",(0,i.jsx)(n.h2,{id:"memory-layout",children:"Memory Layout"}),"\n",(0,i.jsx)(n.mermaid,{value:'pie title Flash Memory (2MB)\n    "Firmware" : 1536\n    "LittleFS" : 512'}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Region"}),(0,i.jsx)(n.th,{children:"Size"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Firmware"}),(0,i.jsx)(n.td,{children:"1.5 MB"}),(0,i.jsx)(n.td,{children:"Application code (XIP)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"LittleFS"}),(0,i.jsx)(n.td,{children:"0.5 MB"}),(0,i.jsx)(n.td,{children:"Settings, fonts, assets"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"freertos-tasks",children:"FreeRTOS Tasks"}),"\n",(0,i.jsx)(n.mermaid,{value:"gantt\n    title Task Execution Timeline (simplified)\n    dateFormat X\n    axisFormat %L\n    \n    section Core 0\n    HeaterCtrl (High) : 0, 10\n    Idle                : 10, 20\n    HeaterCtrl (High) : 20, 30\n    \n    section Core 1\n    LVGL (Normal)     : 0, 15\n    PumpCtrl          : 15, 25\n    LVGL (Normal)     : 25, 40"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Task"}),(0,i.jsx)(n.th,{children:"Stack"}),(0,i.jsx)(n.th,{children:"Priority"}),(0,i.jsx)(n.th,{children:"Core"}),(0,i.jsx)(n.th,{children:"Period"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"HeaterCtrl"})}),(0,i.jsx)(n.td,{children:"4096"}),(0,i.jsx)(n.td,{children:"High"}),(0,i.jsx)(n.td,{children:"0"}),(0,i.jsx)(n.td,{children:"50ms"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PumpCtrl"})}),(0,i.jsx)(n.td,{children:"2048"}),(0,i.jsx)(n.td,{children:"Normal"}),(0,i.jsx)(n.td,{children:"1"}),(0,i.jsx)(n.td,{children:"Event-driven"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LVGL"})}),(0,i.jsx)(n.td,{children:"8192"}),(0,i.jsx)(n.td,{children:"Normal"}),(0,i.jsx)(n.td,{children:"1"}),(0,i.jsx)(n.td,{children:"5ms"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"module-dependencies",children:"Module Dependencies"}),"\n",(0,i.jsx)(n.mermaid,{value:"graph LR\n    subgraph Controllers\n        HC[HeaterController]\n        PC[PumpController]\n    end\n    \n    subgraph Drivers\n        PID[PID]\n        MD[MotorDriver]\n        TD[Temperature]\n        PWM[PWM]\n        ADC[ADC]\n    end\n    \n    HC --\x3e PID\n    HC --\x3e TD\n    HC --\x3e PWM\n    HC --\x3e PC\n    \n    PC --\x3e MD\n    MD --\x3e PWM\n    \n    TD --\x3e ADC\n    \n    style HC fill:#3182ce\n    style PC fill:#3182ce\n    style PID fill:#38a169\n    style MD fill:#38a169\n    style TD fill:#38a169\n    style PWM fill:#38a169\n    style ADC fill:#38a169"})]})}function m(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>l});var r=t(96540);const i={},a=r.createContext(i);function s(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);