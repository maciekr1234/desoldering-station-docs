"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[2258],{3522:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"controllers/heater","title":"Heater Controller","description":"High-level temperature control for the desoldering iron heating element.","source":"@site/docs/controllers/heater.md","sourceDirName":"controllers","slug":"/controllers/heater","permalink":"/desoldering-station-docs/docs/controllers/heater","draft":false,"unlisted":false,"editUrl":"https://github.com/maciekr1234/desoldering-station/tree/master/docs-site/docs/controllers/heater.md","tags":[],"version":"current","lastUpdatedAt":1764728528000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Controllers","permalink":"/desoldering-station-docs/docs/category/controllers"},"next":{"title":"Pump Controller","permalink":"/desoldering-station-docs/docs/controllers/pump"}}');var a=t(4848),i=t(8453);const l={sidebar_position:1},o="Heater Controller",s={},d=[{value:"Overview",id:"overview",level:2},{value:"Features",id:"features",level:2},{value:"State Machine",id:"state-machine",level:2},{value:"API Reference",id:"api-reference",level:2},{value:"Class Definition",id:"class-definition",level:3},{value:"HeaterState Enum",id:"heaterstate-enum",level:3},{value:"Control Loop",id:"control-loop",level:2},{value:"Example Usage",id:"example-usage",level:2},{value:"Safety Features",id:"safety-features",level:2},{value:"Fault Detection",id:"fault-detection",level:3},{value:"Safe Mode",id:"safe-mode",level:3},{value:"Standby Behavior",id:"standby-behavior",level:2},{value:"Source Files",id:"source-files",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"heater-controller",children:"Heater Controller"})}),"\n",(0,a.jsx)(n.p,{children:"High-level temperature control for the desoldering iron heating element."}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"The HeaterController manages the entire heating subsystem, including PID temperature control, state machine management, and integration with the pump and UI systems."}),"\n",(0,a.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"PID-based temperature control"}),"\n",(0,a.jsx)(n.li,{children:"Multi-state operation (Off, Running, Standby, Sleep, Error, Tuning)"}),"\n",(0,a.jsx)(n.li,{children:"Automatic standby on inactivity"}),"\n",(0,a.jsx)(n.li,{children:"Motion-based wake detection"}),"\n",(0,a.jsx)(n.li,{children:"Safety fault detection"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"state-machine",children:"State Machine"}),"\n",(0,a.jsx)(n.mermaid,{value:"stateDiagram-v2\n    [*] --\x3e Off: Power On\n    \n    Off --\x3e Running: start()\n    Running --\x3e Off: stop()\n    \n    Running --\x3e Standby: Idle timeout\n    Standby --\x3e Running: Trigger press\n    \n    Standby --\x3e Sleep: Extended idle\n    Sleep --\x3e Standby: Motion detected\n    Sleep --\x3e Off: Sleep timeout\n    \n    Off --\x3e Tuning: Start auto-tune\n    Tuning --\x3e Off: Tune complete\n    \n    Running --\x3e Error: Fault detected\n    Standby --\x3e Error: Fault detected\n    Error --\x3e Off: Clear error\n    \n    state Running {\n        [*] --\x3e Heating\n        Heating --\x3e AtTemp: Target reached\n        AtTemp --\x3e Heating: Temp drops\n    }\n    \n    state Error {\n        [*] --\x3e SafeMode\n        SafeMode: PWM disabled\n        SafeMode: Fault logged\n    }"}),"\n",(0,a.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,a.jsx)(n.h3,{id:"class-definition",children:"Class Definition"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cpp",children:"class HeaterController {\npublic:\n    HeaterController();\n    HeaterController(pin_size_t heater_pin, uint32_t freq_hz = 25000);\n    ~HeaterController();\n    \n    // Initialization\n    bool begin(pin_size_t heater_pin, uint32_t freq_hz = 25000);\n    bool begin();\n    \n    // State control\n    void changeState(HeaterState new_state);\n    HeaterState getState() const;\n    \n    // Temperature control\n    void setTargetTemperature(uint16_t celsius);\n    uint16_t getTargetTemperature() const;\n    bool isTargetTemperatureReached() const;\n    \n    // PID configuration\n    void setPID(float kp, float ki, float kd);\n    void setPID(float kp, float ki, float kd, float imax, float imin);\n    void setPIDLimits(float imax, float imin);\n    \n    // Pump integration\n    void attachPump(PumpController& pump);\n    PumpController* getPump() const;\n    \n    // Status\n    uint8_t getPowerPercent() const;\n};\n"})}),"\n",(0,a.jsx)(n.h3,{id:"heaterstate-enum",children:"HeaterState Enum"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cpp",children:"enum class HeaterState {\n    Off,      // Heater disabled, PWM = 0\n    Standby,  // Reduced temperature, waiting\n    Sleep,    // Minimal power, motion wake\n    Running,  // Active PID control\n    Error,    // Fault detected, safe mode\n    Tuning,   // PID auto-tune in progress\n};\n"})}),"\n",(0,a.jsx)(n.h2,{id:"control-loop",children:"Control Loop"}),"\n",(0,a.jsx)(n.p,{children:"The heater runs a dedicated FreeRTOS task at high priority:"}),"\n",(0,a.jsx)(n.mermaid,{value:"graph TB\n    Start[Task Start] --\x3e Read[Read Temperature]\n    Read --\x3e Check{State?}\n    \n    Check --\x3e|Running| PID[Compute PID]\n    Check --\x3e|Standby| Standby[Reduced Temp PID]\n    Check --\x3e|Off/Sleep| Zero[PWM = 0]\n    Check --\x3e|Error| Safe[Safe Mode]\n    \n    PID --\x3e SetPWM[Set Heater PWM]\n    Standby --\x3e SetPWM\n    Zero --\x3e SetPWM\n    Safe --\x3e SetPWM\n    \n    SetPWM --\x3e UI[Update UI]\n    UI --\x3e Delay[Delay 50ms]\n    Delay --\x3e Read"}),"\n",(0,a.jsx)(n.h2,{id:"example-usage",children:"Example Usage"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cpp",children:'#include "heater.h"\n#include "pump.h"\n\nHeaterController heater(CONFIG_HEATER_PWM_PIN);\nPumpController pump(/* config */);\n\nvoid setup() {\n    // Link heater and pump\n    heater.attachPump(pump);\n    \n    // Configure PID\n    heater.setPID(1.0f, 0.8f, 3.5f, 5.0f, 0.0f);\n    \n    // Initialize\n    if (!heater.begin()) {\n        PICO_LOGE("MAIN", "Heater init failed");\n        return;\n    }\n    \n    // Set target and start\n    heater.setTargetTemperature(350);\n    heater.changeState(HeaterState::Running);\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"safety-features",children:"Safety Features"}),"\n",(0,a.jsx)(n.h3,{id:"fault-detection",children:"Fault Detection"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Fault"}),(0,a.jsx)(n.th,{children:"Condition"}),(0,a.jsx)(n.th,{children:"Action"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Open thermocouple"}),(0,a.jsx)(n.td,{children:"ADC > 4000"}),(0,a.jsx)(n.td,{children:"Enter Error state"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Overheat"}),(0,a.jsx)(n.td,{children:"Temp > 500\xb0C"}),(0,a.jsx)(n.td,{children:"Enter Error state"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Runaway"}),(0,a.jsx)(n.td,{children:"Temp rising despite PWM=0"}),(0,a.jsx)(n.td,{children:"Enter Error state"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Timeout"}),(0,a.jsx)(n.td,{children:"Target not reached in 60s"}),(0,a.jsx)(n.td,{children:"Warning only"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"safe-mode",children:"Safe Mode"}),"\n",(0,a.jsx)(n.p,{children:"When entering Error state:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"PWM immediately set to 0"}),"\n",(0,a.jsx)(n.li,{children:"PID controller reset"}),"\n",(0,a.jsx)(n.li,{children:"Error logged"}),"\n",(0,a.jsx)(n.li,{children:"UI notified"}),"\n",(0,a.jsx)(n.li,{children:"Manual reset required"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"standby-behavior",children:"Standby Behavior"}),"\n",(0,a.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant User\n    participant Trigger\n    participant Heater\n    participant Motion\n    \n    Note over Heater: Running @ 350\xb0C\n    \n    User->>Trigger: Release (set down)\n    Note over Heater: Start idle timer\n    \n    Note over Heater: 60s no activity\n    Heater->>Heater: Enter Standby\n    Note over Heater: Reduce to 200\xb0C\n    \n    User->>Trigger: Press (pick up)\n    Trigger->>Heater: Wake signal\n    Heater->>Heater: Enter Running\n    Note over Heater: Return to 350\xb0C"}),"\n",(0,a.jsx)(n.h2,{id:"source-files",children:"Source Files"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Header: ",(0,a.jsx)(n.code,{children:"include/heater.h"})]}),"\n",(0,a.jsxs)(n.li,{children:["Implementation: ",(0,a.jsx)(n.code,{children:"src/heater.cpp"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>o});var r=t(6540);const a={},i=r.createContext(a);function l(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);