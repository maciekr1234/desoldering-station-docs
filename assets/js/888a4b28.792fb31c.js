"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[9446],{7997:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>s,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"controllers/pump","title":"Pump Controller","description":"Vacuum pump motor control with trigger debouncing.","source":"@site/docs/controllers/pump.md","sourceDirName":"controllers","slug":"/controllers/pump","permalink":"/desoldering-station-docs/docs/controllers/pump","draft":false,"unlisted":false,"editUrl":"https://github.com/maciekr1234/desoldering-station/tree/master/docs-site/docs/controllers/pump.md","tags":[],"version":"current","lastUpdatedAt":1764782273000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Heater Controller","permalink":"/desoldering-station-docs/docs/controllers/heater"},"next":{"title":"Core","permalink":"/desoldering-station-docs/docs/category/core"}}');var i=r(4848),o=r(8453);const s={sidebar_position:2},l="Pump Controller",a={},d=[{value:"Overview",id:"overview",level:2},{value:"Features",id:"features",level:2},{value:"Debounce State Machine",id:"debounce-state-machine",level:2},{value:"API Reference",id:"api-reference",level:2},{value:"Class Definition",id:"class-definition",level:3},{value:"Trigger Handling",id:"trigger-handling",level:2},{value:"Hardware Setup",id:"hardware-setup",level:3},{value:"IRQ Handler",id:"irq-handler",level:3},{value:"Example Usage",id:"example-usage",level:2},{value:"Integration with Heater",id:"integration-with-heater",level:2},{value:"Motor Control",id:"motor-control",level:2},{value:"Speed Ramping",id:"speed-ramping",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Timing Constants",id:"timing-constants",level:2},{value:"Source Files",id:"source-files",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"pump-controller",children:"Pump Controller"})}),"\n",(0,i.jsx)(n.p,{children:"Vacuum pump motor control with trigger debouncing."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The PumpController manages the vacuum pump motor, handling trigger input debouncing, motor speed control, and integration with the heater system for coordinated operation."}),"\n",(0,i.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Hardware trigger debouncing"}),"\n",(0,i.jsx)(n.li,{children:"Soft start/stop motor control"}),"\n",(0,i.jsx)(n.li,{children:"Speed configuration"}),"\n",(0,i.jsx)(n.li,{children:"Callback support for state changes"}),"\n",(0,i.jsx)(n.li,{children:"IRQ-based trigger detection"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"debounce-state-machine",children:"Debounce State Machine"}),"\n",(0,i.jsx)(n.mermaid,{value:"stateDiagram-v2\n    [*] --\x3e IDLE: Initialize\n    \n    IDLE --\x3e DEBOUNCING: Trigger pressed (falling edge)\n    DEBOUNCING --\x3e STABLE: Timeout (50ms, still pressed)\n    DEBOUNCING --\x3e IDLE: Released (bounce detected)\n    \n    STABLE --\x3e DEBOUNCING_REL: Trigger released (rising edge)\n    DEBOUNCING_REL --\x3e IDLE: Timeout (50ms, still released)\n    DEBOUNCING_REL --\x3e STABLE: Pressed (bounce detected)\n    \n    state IDLE {\n        [*] --\x3e Waiting\n        Waiting: Motor OFF\n        Waiting: Awaiting trigger\n    }\n    \n    state STABLE {\n        [*] --\x3e Active\n        Active: Motor ON\n        Active: Pump running\n    }"}),"\n",(0,i.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,i.jsx)(n.h3,{id:"class-definition",children:"Class Definition"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"class PumpController {\npublic:\n    using trigger_callback_t = std::function<void(bool pressed)>;\n    \n    // Debounce states\n    enum class DebounceState {\n        IDLE,       // Waiting for trigger\n        DEBOUNCING, // Validating press/release\n        STABLE      // Confirmed state\n    };\n    \n    static constexpr uint32_t DEBOUNCE_DELAY_MS = 50;\n    \n    PumpController(pin_size_t trigger_pin, motor_driver_config_t motor_cfg);\n    ~PumpController();\n    \n    // Initialization\n    bool begin(pin_size_t trigger_pin);\n    bool begin();\n    void end();\n    \n    // Update (call from task)\n    void update();\n    \n    // Trigger state\n    bool readTrigger();\n    bool isTriggerPressed() const;\n    \n    // Configuration\n    void setTriggerPin(pin_size_t pin);\n    pin_size_t getTriggerPin() const;\n    void setTriggerCallback(trigger_callback_t cb);\n    \n    // Motor access\n    MotorDriver& getMotorDriver();\n};\n"})}),"\n",(0,i.jsx)(n.h2,{id:"trigger-handling",children:"Trigger Handling"}),"\n",(0,i.jsx)(n.h3,{id:"hardware-setup",children:"Hardware Setup"}),"\n",(0,i.jsx)(n.p,{children:"The trigger is connected to a GPIO with internal pullup:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"    VCC\n     |\n    [R] Internal Pullup\n     |\n    GPIO ---+--- To MCU\n            |\n           [ ] Trigger Switch\n            |\n           GND\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Idle"}),": GPIO reads HIGH (pullup)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Pressed"}),": GPIO reads LOW (grounded)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"irq-handler",children:"IRQ Handler"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// ISR in RAM for flash safety\n__not_in_flash_func(void _pump_controller_irq)(void* vptr) {\n    auto* pump = static_cast<PumpController*>(vptr);\n    // Set flag for task processing\n    pump->_changed = true;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"example-usage",children:"Example Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'#include "pump.h"\n\nmotor_driver_config_t motor_cfg = {\n    .in1_pin = 2,\n    .in2_pin = 3,\n    .pwm_freq = 20000,\n    .accel_time_ms = 500\n};\n\nPumpController pump(15, motor_cfg);\n\nvoid setup() {\n    pump.begin();\n    \n    // Optional: get notified of trigger changes\n    pump.setTriggerCallback([](bool pressed) {\n        PICO_LOGI("PUMP", "Trigger %s", pressed ? "pressed" : "released");\n    });\n    \n    // Configure motor\n    pump.getMotorDriver().setAccelerationTime(300);\n}\n\nvoid pump_task() {\n    while (true) {\n        pump.update();\n        vTaskDelay(pdMS_TO_TICKS(10));\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"integration-with-heater",children:"Integration with Heater"}),"\n",(0,i.jsx)(n.p,{children:"The pump is attached to the heater controller for coordinated operation:"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant User\n    participant Pump\n    participant Heater\n    participant Motor\n    \n    User->>Pump: Press trigger\n    Pump->>Pump: Debounce (50ms)\n    Pump->>Heater: Trigger callback\n    Heater->>Heater: Wake from standby\n    Pump->>Motor: Start motor\n    \n    Note over Motor: Pump running\n    \n    User->>Pump: Release trigger\n    Pump->>Pump: Debounce (50ms)\n    Pump->>Motor: Stop motor\n    Pump->>Heater: Trigger callback\n    Note over Heater: Start idle timer"}),"\n",(0,i.jsx)(n.h2,{id:"motor-control",children:"Motor Control"}),"\n",(0,i.jsx)(n.h3,{id:"speed-ramping",children:"Speed Ramping"}),"\n",(0,i.jsx)(n.p,{children:"The motor uses soft start to prevent current spikes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Speed %\n100 |        ___________\n    |       /\n 50 |      /\n    |     /\n  0 |____/\n    0   500ms        Time\n"})}),"\n",(0,i.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// Set acceleration time\npump.getMotorDriver().setAccelerationTime(500);  // 500ms ramp\n\n// Set maximum speed (if needed)\npump.getMotorDriver().setSpeed(80);  // 80% max\n"})}),"\n",(0,i.jsx)(n.h2,{id:"timing-constants",children:"Timing Constants"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Constant"}),(0,i.jsx)(n.th,{children:"Value"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DEBOUNCE_DELAY_MS"})}),(0,i.jsx)(n.td,{children:"50 ms"}),(0,i.jsx)(n.td,{children:"Press/release debounce"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RELEASE_DEBOUNCE_DELAY_MS"})}),(0,i.jsx)(n.td,{children:"50 ms"}),(0,i.jsx)(n.td,{children:"Release debounce"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Motor acceleration"}),(0,i.jsx)(n.td,{children:"500 ms"}),(0,i.jsx)(n.td,{children:"Soft start duration"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"source-files",children:"Source Files"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Header: ",(0,i.jsx)(n.code,{children:"include/pump.h"})]}),"\n",(0,i.jsxs)(n.li,{children:["Implementation: ",(0,i.jsx)(n.code,{children:"src/pump.cpp"})]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>l});var t=r(6540);const i={},o=t.createContext(i);function s(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);