<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-api/files/src-heater-cpp" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">The heater.cpp File Reference | Desoldering Station</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://maciekr1234.github.io/desoldering-station-docs/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://maciekr1234.github.io/desoldering-station-docs/img/social-card.png"><meta data-rh="true" property="og:url" content="https://maciekr1234.github.io/desoldering-station-docs/docs/api/files/src/heater-cpp"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="The heater.cpp File Reference | Desoldering Station"><meta data-rh="true" name="description" content="Included Headers"><meta data-rh="true" property="og:description" content="Included Headers"><meta data-rh="true" name="keywords" content="doxygen,reference,file"><link data-rh="true" rel="icon" href="/desoldering-station-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://maciekr1234.github.io/desoldering-station-docs/docs/api/files/src/heater-cpp"><link data-rh="true" rel="alternate" href="https://maciekr1234.github.io/desoldering-station-docs/docs/api/files/src/heater-cpp" hreflang="en"><link data-rh="true" rel="alternate" href="https://maciekr1234.github.io/desoldering-station-docs/docs/api/files/src/heater-cpp" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"API Reference (Doxygen)","item":"https://maciekr1234.github.io/desoldering-station-docs/docs/api/"},{"@type":"ListItem","position":2,"name":"Files","item":"https://maciekr1234.github.io/desoldering-station-docs/docs/api/files"},{"@type":"ListItem","position":3,"name":"src","item":"https://maciekr1234.github.io/desoldering-station-docs/docs/api/folders/src"},{"@type":"ListItem","position":4,"name":"heater.cpp","item":"https://maciekr1234.github.io/desoldering-station-docs/docs/api/files/src/heater-cpp"}]}</script><link rel="alternate" type="application/rss+xml" href="/desoldering-station-docs/blog/rss.xml" title="Desoldering Station RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/desoldering-station-docs/blog/atom.xml" title="Desoldering Station Atom Feed">






<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous"><link rel="stylesheet" href="/desoldering-station-docs/assets/css/styles.690525c2.css">
<script src="/desoldering-station-docs/assets/js/runtime~main.4616e6bc.js" defer="defer"></script>
<script src="/desoldering-station-docs/assets/js/main.a0f1c532.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/desoldering-station-docs/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/desoldering-station-docs/"><div class="navbar__logo"><img src="/desoldering-station-docs/img/logo.svg" alt="Desoldering Station Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/desoldering-station-docs/img/logo.svg" alt="Desoldering Station Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Desoldering Station</b></a><a class="navbar__item navbar__link" href="/desoldering-station-docs/docs/intro">Documentation</a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/desoldering-station-docs/docs/api">Reference</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/desoldering-station-docs/docs/api/namespaces">Namespaces</a></li><li><a class="dropdown__link" href="/desoldering-station-docs/docs/api/classes">Classes</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/desoldering-station-docs/docs/api/files">Files</a></li></ul></div><a class="navbar__item navbar__link" href="/desoldering-station-docs/blog">Updates</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/desoldering-station-docs/docs/api/files/src/heater-cpp">Next ðŸš§</a><a href="https://github.com/maciekr1234/desoldering-station" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/desoldering-station-docs/docs/api"><span title="API Reference (Doxygen)" class="categoryLinkLabel_W154">API Reference (Doxygen)</span></a><button aria-label="Collapse sidebar category &#x27;API Reference (Doxygen)&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/desoldering-station-docs/docs/api/namespaces"><span title="Namespaces" class="categoryLinkLabel_W154">Namespaces</span></a><button aria-label="Expand sidebar category &#x27;Namespaces&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/desoldering-station-docs/docs/api/classes"><span title="Classes" class="categoryLinkLabel_W154">Classes</span></a><button aria-label="Expand sidebar category &#x27;Classes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/desoldering-station-docs/docs/api/files"><span title="Files" class="categoryLinkLabel_W154">Files</span></a><button aria-label="Collapse sidebar category &#x27;Files&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/desoldering-station-docs/docs/api/folders/include"><span title="include" class="categoryLinkLabel_W154">include</span></a><button aria-label="Expand sidebar category &#x27;include&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/desoldering-station-docs/docs/api/folders/src"><span title="src" class="categoryLinkLabel_W154">src</span></a><button aria-label="Collapse sidebar category &#x27;src&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/desoldering-station-docs/docs/api/folders/src/src/core"><span title="src/core" class="categoryLinkLabel_W154">src/core</span></a><button aria-label="Expand sidebar category &#x27;src/core&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/desoldering-station-docs/docs/api/folders/src/src/drivers"><span title="src/drivers" class="categoryLinkLabel_W154">src/drivers</span></a><button aria-label="Expand sidebar category &#x27;src/drivers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/desoldering-station-docs/docs/api/folders/src/src/gui"><span title="src/gui" class="categoryLinkLabel_W154">src/gui</span></a><button aria-label="Expand sidebar category &#x27;src/gui&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/desoldering-station-docs/docs/api/files/src/heater-cpp"><span title="heater.cpp" class="linkLabel_WmDU">heater.cpp</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/desoldering-station-docs/docs/api/files/src/lv-port-cpp"><span title="lv_port.cpp" class="linkLabel_WmDU">lv_port.cpp</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/desoldering-station-docs/docs/api/files/src/main-cpp"><span title="main.cpp" class="linkLabel_WmDU">main.cpp</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/desoldering-station-docs/docs/api/files/src/pump-cpp"><span title="pump.cpp" class="linkLabel_WmDU">pump.cpp</span></a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/desoldering-station-docs/docs/api/pages/deprecated"><span title="Pages" class="categoryLinkLabel_W154">Pages</span></a></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/desoldering-station-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/desoldering-station-docs/docs/api"><span>API Reference (Doxygen)</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/desoldering-station-docs/docs/api/files"><span>Files</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/desoldering-station-docs/docs/api/folders/src"><span>src</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">heater.cpp</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>The <code>heater.cpp</code> File Reference</h1></header>
<div class="doxyPage"><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="included-headers">Included Headers<a href="#included-headers" class="hash-link" aria-label="Direct link to Included Headers" title="Direct link to Included Headers" translate="no">â€‹</a></h2><div class="doxyIncludesList"><code>#include <!-- -->&lt;<!-- -->Arduino.h<!-- -->&gt;</code><br><code>#include <!-- -->&lt;<!-- -->cmath<!-- -->&gt;</code><br><code>#include <!-- -->&quot;<a href="/desoldering-station-docs/docs/api/files/include/heater-h">heater.h</a>&quot;</code><br><code>#include <!-- -->&quot;<a href="/desoldering-station-docs/docs/api/files/include/settings-h">settings.h</a>&quot;</code><br><code>#include <!-- -->&quot;<a href="/desoldering-station-docs/docs/api/files/include/include/gui/global-h">gui/global.h</a>&quot;</code><br><code>#include <!-- -->&quot;<a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h">core/pico_log.h</a>&quot;</code><br><code>#include <!-- -->&quot;<a href="/desoldering-station-docs/docs/api/files/include/include/core/auto-tuner-h">core/auto_tuner.h</a>&quot;</code><br><code>#include <!-- -->&quot;<a href="/desoldering-station-docs/docs/api/files/include/include/drivers/temperature-h">drivers/temperature.h</a>&quot;</code><br></div><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="classes-index">Classes Index<a href="#classes-index" class="hash-link" aria-label="Direct link to Classes Index" title="Direct link to Classes Index" translate="no">â€‹</a></h2><table class="doxyMembersIndex"><tr class="doxyMemberIndexItem"><td class="doxyMemberIndexItemType" align="right" valign="top">struct</td><td class="doxyMemberIndexItemName" align="left" valign="top"><a class="" href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a></td></tr><tr class="doxyMemberIndexDescription"><td class="doxyMemberIndexDescriptionLeft"></td><td class="doxyMemberIndexDescriptionRight"></td></tr><tr class="doxyMemberIndexSeparator"><td class="doxyMemberIndexSeparator" colspan="2"></td></tr></table><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="enumerations-index">Enumerations Index<a href="#enumerations-index" class="hash-link" aria-label="Direct link to Enumerations Index" title="Direct link to Enumerations Index" translate="no">â€‹</a></h2><table class="doxyMembersIndex"><tr class="doxyMemberIndexItem"><td class="doxyMemberIndexItemType" align="right" valign="top">enum class</td><td class="doxyMemberIndexItemName" align="left" valign="top">:  { <a href="#a8dc2c250cb794c4483f1d66b87b1b25b" class="">...</a> }</td></tr><tr class="doxyMemberIndexDescription"><td class="doxyMemberIndexDescriptionLeft"></td><td class="doxyMemberIndexDescriptionRight"></td></tr><tr class="doxyMemberIndexSeparator"><td class="doxyMemberIndexSeparator" colspan="2"></td></tr></table><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="functions-index">Functions Index<a href="#functions-index" class="hash-link" aria-label="Direct link to Functions Index" title="Direct link to Functions Index" translate="no">â€‹</a></h2><table class="doxyMembersIndex"><tr class="doxyMemberIndexItem"><td class="doxyMemberIndexItemType" align="right" valign="top">void</td><td class="doxyMemberIndexItemName" align="left" valign="top"><a href="#a64e3c453aa85ff621214fa7b5f68ef20" class="">_heater_task</a> (void *vptr)</td></tr><tr class="doxyMemberIndexDescription"><td class="doxyMemberIndexDescriptionLeft"></td><td class="doxyMemberIndexDescriptionRight"></td></tr><tr class="doxyMemberIndexSeparator"><td class="doxyMemberIndexSeparator" colspan="2"></td></tr></table><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="variables-index">Variables Index<a href="#variables-index" class="hash-link" aria-label="Direct link to Variables Index" title="Direct link to Variables Index" translate="no">â€‹</a></h2><table class="doxyMembersIndex"><tr class="doxyMemberIndexItem"><td class="doxyMemberIndexItemType" align="right" valign="top">const char *</td><td class="doxyMemberIndexItemName" align="left" valign="top"><a href="#a5a85b9c772bbeb480b209a3e6ea92b4c" class="">TAG</a> = &quot;heater&quot;</td></tr><tr class="doxyMemberIndexDescription"><td class="doxyMemberIndexDescriptionLeft"></td><td class="doxyMemberIndexDescriptionRight"></td></tr><tr class="doxyMemberIndexSeparator"><td class="doxyMemberIndexSeparator" colspan="2"></td></tr></table><div class="doxySectionDef"><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="enumerations">Enumerations<a href="#enumerations" class="hash-link" aria-label="Direct link to Enumerations" title="Direct link to Enumerations" translate="no">â€‹</a></h2><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="a8dc2c250cb794c4483f1d66b87b1b25b">enum class<a href="#a8dc2c250cb794c4483f1d66b87b1b25b" class="hash-link" aria-label="Direct link to enum class" title="Direct link to enum class" translate="no">â€‹</a></h3><div class="doxyMemberItem"><div class="doxyMemberProto"><table class="doxyMemberLabels"><tbody><tr class="doxyMemberLabels"><td class="doxyMemberLabelsLeft"><table class="doxyMemberName"><tbody><tr><td class="doxyMemberName">enum class HeaterCallbackType </td></tr></tbody></table></td><td class="doxyMemberLabelsRight"><span class="doxyMemberLabels"><span class="doxyMemberLabel strong">strong</span></span></td></tr></tbody></table></div><div class="doxyMemberDoc"><dl class="doxyEnumList"><dt class="doxyEnumTableTitle">Enumeration values</dt><dd><table class="doxyEnumTable"><a id="a8dc2c250cb794c4483f1d66b87b1b25ba46a2a41cc6e552044816a2d04634545d"></a><tr class="doxyEnumItem"><td class="doxyEnumItemName">State</td><td class="doxyEnumItemDescription"></td></tr><a id="a8dc2c250cb794c4483f1d66b87b1b25ba547dadef6304affc26261ec5ed2f2011"></a><tr class="doxyEnumItem"><td class="doxyEnumItemName">Setpoint</td><td class="doxyEnumItemDescription"></td></tr><a id="a8dc2c250cb794c4483f1d66b87b1b25ba94c32656e1f1acab08c781de14231031"></a><tr class="doxyEnumItem"><td class="doxyEnumItemName">Reached</td><td class="doxyEnumItemDescription"></td></tr><a id="a8dc2c250cb794c4483f1d66b87b1b25ba902b0d55fddef6f8d651fe1035b7d4bd"></a><tr class="doxyEnumItem"><td class="doxyEnumItemName">Error</td><td class="doxyEnumItemDescription"></td></tr></table></dd></dl><p>Definition at line <a href="#l00015">15</a> of file <a href="/desoldering-station-docs/docs/api/files/src/heater-cpp">heater.cpp</a>.</p></div></div></div><div class="doxySectionDef"><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="functions">Functions<a href="#functions" class="hash-link" aria-label="Direct link to Functions" title="Direct link to Functions" translate="no">â€‹</a></h2><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="a64e3c453aa85ff621214fa7b5f68ef20">_heater_task()<a href="#a64e3c453aa85ff621214fa7b5f68ef20" class="hash-link" aria-label="Direct link to _heater_task()" title="Direct link to _heater_task()" translate="no">â€‹</a></h3><div class="doxyMemberItem"><div class="doxyMemberProto"><table class="doxyMemberLabels"><tbody><tr class="doxyMemberLabels"><td class="doxyMemberLabelsLeft"><table class="doxyMemberName"><tbody><tr><td class="doxyMemberName">void _heater_task (void * vptr)</td></tr></tbody></table></td></tr></tbody></table></div><div class="doxyMemberDoc"><p>Definition at line <a href="#l00035">35</a> of file <a href="/desoldering-station-docs/docs/api/files/src/heater-cpp">heater.cpp</a>.</p></div></div></div><div class="doxySectionDef"><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="variables">Variables<a href="#variables" class="hash-link" aria-label="Direct link to Variables" title="Direct link to Variables" translate="no">â€‹</a></h2><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="a5a85b9c772bbeb480b209a3e6ea92b4c">TAG<a href="#a5a85b9c772bbeb480b209a3e6ea92b4c" class="hash-link" aria-label="Direct link to TAG" title="Direct link to TAG" translate="no">â€‹</a></h3><div class="doxyMemberItem"><div class="doxyMemberProto"><table class="doxyMemberLabels"><tbody><tr class="doxyMemberLabels"><td class="doxyMemberLabelsLeft"><table class="doxyMemberName"><tbody><tr><td class="doxyMemberName">const char* TAG = &quot;heater&quot;</td></tr></tbody></table></td><td class="doxyMemberLabelsRight"><span class="doxyMemberLabels"><span class="doxyMemberLabel static">static</span></span></td></tr></tbody></table></div><div class="doxyMemberDoc"><p>Definition at line <a href="#l00012">12</a> of file <a href="/desoldering-station-docs/docs/api/files/src/heater-cpp">heater.cpp</a>.</p></div></div></div><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="file-listing">File Listing<a href="#file-listing" class="hash-link" aria-label="Direct link to File Listing" title="Direct link to File Listing" translate="no">â€‹</a></h2><p>The file content with the documentation metadata removed is:</p><div class="doxyProgramListing"><a id="l00001"></a><div class="doxyCodeLine"><span class="doxyLineNumber">1</span><span class="doxyLineContent"><span class="doxyHighlightPreprocessor">#include &lt;Arduino.h&gt;</span></span></div><a id="l00002"></a><div class="doxyCodeLine"><span class="doxyLineNumber">2</span><span class="doxyLineContent"><span class="doxyHighlightPreprocessor">#include &lt;cmath&gt;</span></span></div><a id="l00003"></a><div class="doxyCodeLine"><span class="doxyLineNumber">3</span><span class="doxyLineContent"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/desoldering-station-docs/docs/api/files/include/heater-h">heater.h</a>&quot;</span></span></div><a id="l00004"></a><div class="doxyCodeLine"><span class="doxyLineNumber">4</span><span class="doxyLineContent"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/desoldering-station-docs/docs/api/files/include/settings-h">settings.h</a>&quot;</span></span></div><a id="l00005"></a><div class="doxyCodeLine"><span class="doxyLineNumber">5</span><span class="doxyLineContent"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/desoldering-station-docs/docs/api/files/include/include/gui/global-h">gui/global.h</a>&quot;</span></span></div><a id="l00006"></a><div class="doxyCodeLine"><span class="doxyLineNumber">6</span><span class="doxyLineContent"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h">core/pico_log.h</a>&quot;</span></span></div><a id="l00007"></a><div class="doxyCodeLine"><span class="doxyLineNumber">7</span><span class="doxyLineContent"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/desoldering-station-docs/docs/api/files/include/include/core/auto-tuner-h">core/auto_tuner.h</a>&quot;</span></span></div><a id="l00008"></a><div class="doxyCodeLine"><span class="doxyLineNumber">8</span><span class="doxyLineContent"></span></div><a id="l00009"></a><div class="doxyCodeLine"><span class="doxyLineNumber">9</span><span class="doxyLineContent"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/desoldering-station-docs/docs/api/files/include/include/drivers/temperature-h">drivers/temperature.h</a>&quot;</span></span></div><a id="l00010"></a><div class="doxyCodeLine"><span class="doxyLineNumber">10</span><span class="doxyLineContent"></span></div><a id="l00011"></a><div class="doxyCodeLine"><span class="doxyLineNumber">11</span><span class="doxyLineContent"></span></div><a id="l00012"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="#a5a85b9c772bbeb480b209a3e6ea92b4c">12</a></span><span class="doxyLineContent"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight">* <a href="#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a> = </span><span class="doxyHighlightStringLiteral">&quot;heater&quot;</span><span class="doxyHighlight">;</span></span></div><a id="l00013"></a><div class="doxyCodeLine"><span class="doxyLineNumber">13</span><span class="doxyLineContent"></span></div><a id="l00014"></a><div class="doxyCodeLine"><span class="doxyLineNumber">14</span><span class="doxyLineContent"><span class="doxyHighlightComment">// Callback event types for linked list storage</span></span></div><a id="l00015"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="#a8dc2c250cb794c4483f1d66b87b1b25b">15</a></span><span class="doxyLineContent"><span class="doxyHighlightKeyword">enum class</span><span class="doxyHighlight"> <a href="#a8dc2c250cb794c4483f1d66b87b1b25b">HeaterCallbackType</a> {</span></span></div><a id="l00016"></a><div class="doxyCodeLine"><span class="doxyLineNumber">16</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="#a8dc2c250cb794c4483f1d66b87b1b25ba46a2a41cc6e552044816a2d04634545d">State</a>,</span></span></div><a id="l00017"></a><div class="doxyCodeLine"><span class="doxyLineNumber">17</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="#a8dc2c250cb794c4483f1d66b87b1b25ba547dadef6304affc26261ec5ed2f2011">Setpoint</a>,</span></span></div><a id="l00018"></a><div class="doxyCodeLine"><span class="doxyLineNumber">18</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="#a8dc2c250cb794c4483f1d66b87b1b25ba94c32656e1f1acab08c781de14231031">Reached</a>,</span></span></div><a id="l00019"></a><div class="doxyCodeLine"><span class="doxyLineNumber">19</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="#a8dc2c250cb794c4483f1d66b87b1b25ba902b0d55fddef6f8d651fe1035b7d4bd">Error</a></span></span></div><a id="l00020"></a><div class="doxyCodeLine"><span class="doxyLineNumber">20</span><span class="doxyLineContent"><span class="doxyHighlight">};</span></span></div><a id="l00021"></a><div class="doxyCodeLine"><span class="doxyLineNumber">21</span><span class="doxyLineContent"></span></div><a id="l00022"></a><div class="doxyCodeLine"><span class="doxyLineNumber">22</span><span class="doxyLineContent"><span class="doxyHighlightComment">// Linked list node for callbacks</span></span></div><a id="l00023"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">23</a></span><span class="doxyLineContent"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a> {</span></span></div><a id="l00024"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#abc184d098cd13a31cb92159220ff99e8">24</a></span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="#a8dc2c250cb794c4483f1d66b87b1b25b">HeaterCallbackType</a> <a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#abc184d098cd13a31cb92159220ff99e8">type</a>;</span></span></div><a id="l00025"></a><div class="doxyCodeLine"><span class="doxyLineNumber">25</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">union </span><span class="doxyHighlight">{</span></span></div><a id="l00026"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#a62b08e69e32e5a5459ae638df6c954c2">26</a></span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a2f52ca9a7e38d31e97e39257903fc9c1">heater_state_cb_t</a>    <a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#a62b08e69e32e5a5459ae638df6c954c2">state_cb</a>;</span></span></div><a id="l00027"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#a3e663eed24bafd1cb1410ff50430ebdd">27</a></span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a7e8532e17ccdc5e249601d94f11d4875">heater_setpoint_cb_t</a> <a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#a3e663eed24bafd1cb1410ff50430ebdd">setpoint_cb</a>;</span></span></div><a id="l00028"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#a6cb9d740f176f0f6637d7862fc386194">28</a></span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a5078618ec7fb9b02c16ca69c72818492">heater_reached_cb_t</a>  <a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#a6cb9d740f176f0f6637d7862fc386194">reached_cb</a>;</span></span></div><a id="l00029"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#a2f1972ea123fc2e3edf8947faf93d04d">29</a></span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a4f38f774f4f56ed0c7f0648209eb366f">heater_error_cb_t</a>    <a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#a2f1972ea123fc2e3edf8947faf93d04d">error_cb</a>;</span></span></div><a id="l00030"></a><div class="doxyCodeLine"><span class="doxyLineNumber">30</span><span class="doxyLineContent"><span class="doxyHighlight">    };</span></span></div><a id="l00031"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#acc93ca465f7bf4c6229239fbdbcd858a">31</a></span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">*            <a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#acc93ca465f7bf4c6229239fbdbcd858a">user_data</a>;</span></span></div><a id="l00032"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#accad0c1a0b60149a5399571f2ee68f98">32</a></span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>*  <a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#accad0c1a0b60149a5399571f2ee68f98">next</a>;</span></span></div><a id="l00033"></a><div class="doxyCodeLine"><span class="doxyLineNumber">33</span><span class="doxyLineContent"><span class="doxyHighlight">};</span></span></div><a id="l00034"></a><div class="doxyCodeLine"><span class="doxyLineNumber">34</span><span class="doxyLineContent"></span></div><a id="l00035"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a989aa47cea863d56b3cf18adbf6d28d1">35</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a64e3c453aa85ff621214fa7b5f68ef20">_heater_task</a>(</span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">* vptr) {</span></span></div><a id="l00036"></a><div class="doxyCodeLine"><span class="doxyLineNumber">36</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight">* heater = </span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlight"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller">HeaterController</a>*</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(vptr);</span></span></div><a id="l00037"></a><div class="doxyCodeLine"><span class="doxyLineNumber">37</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (heater) {</span></span></div><a id="l00038"></a><div class="doxyCodeLine"><span class="doxyLineNumber">38</span><span class="doxyLineContent"><span class="doxyHighlight">        heater-&gt;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a335f6c999504989a02b9952fcade2de0">update</a>();</span></span></div><a id="l00039"></a><div class="doxyCodeLine"><span class="doxyLineNumber">39</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00040"></a><div class="doxyCodeLine"><span class="doxyLineNumber">40</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00041"></a><div class="doxyCodeLine"><span class="doxyLineNumber">41</span><span class="doxyLineContent"></span></div><a id="l00042"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a5df391269d4b48887d046470bb4adccc">42</a></span><span class="doxyLineContent"><span class="doxyHighlight"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a5df391269d4b48887d046470bb4adccc">HeaterController::HeaterController</a>() {</span></span></div><a id="l00043"></a><div class="doxyCodeLine"><span class="doxyLineNumber">43</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a> = xSemaphoreCreateMutex();</span></span></div><a id="l00044"></a><div class="doxyCodeLine"><span class="doxyLineNumber">44</span><span class="doxyLineContent"></span></div><a id="l00045"></a><div class="doxyCodeLine"><span class="doxyLineNumber">45</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a> = {</span></span></div><a id="l00046"></a><div class="doxyCodeLine"><span class="doxyLineNumber">46</span><span class="doxyLineContent"><span class="doxyHighlight">        .<a href="/desoldering-station-docs/docs/api/structs/pid-ctrl-parameter-t/#ae4f749144e4aa235682adc0c6b92b649">kp</a>           = 1.0f,                   </span><span class="doxyHighlightComment">// Proportional gain</span></span></div><a id="l00047"></a><div class="doxyCodeLine"><span class="doxyLineNumber">47</span><span class="doxyLineContent"><span class="doxyHighlight">        .ki           = 0.8f,                   </span><span class="doxyHighlightComment">// Integral gain</span></span></div><a id="l00048"></a><div class="doxyCodeLine"><span class="doxyLineNumber">48</span><span class="doxyLineContent"><span class="doxyHighlight">        .kd           = 3.5f,                   </span><span class="doxyHighlightComment">// Derivative gain</span></span></div><a id="l00049"></a><div class="doxyCodeLine"><span class="doxyLineNumber">49</span><span class="doxyLineContent"><span class="doxyHighlight">        .max_output   = 1.0f,                   </span><span class="doxyHighlightComment">// Maximum output (e.g., PWM duty cycle)</span></span></div><a id="l00050"></a><div class="doxyCodeLine"><span class="doxyLineNumber">50</span><span class="doxyLineContent"><span class="doxyHighlight">        .min_output   = 0.0f,                   </span><span class="doxyHighlightComment">// Minimum output</span></span></div><a id="l00051"></a><div class="doxyCodeLine"><span class="doxyLineNumber">51</span><span class="doxyLineContent"><span class="doxyHighlight">        .max_integral = 5.0f,                   </span><span class="doxyHighlightComment">// Integral windup limit (positive)</span></span></div><a id="l00052"></a><div class="doxyCodeLine"><span class="doxyLineNumber">52</span><span class="doxyLineContent"><span class="doxyHighlight">        .min_integral = 0.0f,                   </span><span class="doxyHighlightComment">// Integral windup limit (negative)</span></span></div><a id="l00053"></a><div class="doxyCodeLine"><span class="doxyLineNumber">53</span><span class="doxyLineContent"><span class="doxyHighlight">        .cal_type     = <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pid-h/#a1ef119fb3e229f643f8f7a94aa7df5d1aa51daab3677dabc3b567a20db32397e0">PID_CAL_TYPE_POSITIONAL</a> </span><span class="doxyHighlightComment">// Use positional PID for heater control</span></span></div><a id="l00054"></a><div class="doxyCodeLine"><span class="doxyLineNumber">54</span><span class="doxyLineContent"><span class="doxyHighlight">    };</span></span></div><a id="l00055"></a><div class="doxyCodeLine"><span class="doxyLineNumber">55</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00056"></a><div class="doxyCodeLine"><span class="doxyLineNumber">56</span><span class="doxyLineContent"></span></div><a id="l00057"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#acc4aaac39348f21a9d44d0c39d3c629b">57</a></span><span class="doxyLineContent"><span class="doxyHighlight"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#acc4aaac39348f21a9d44d0c39d3c629b">HeaterController::~HeaterController</a>() {</span></span></div><a id="l00058"></a><div class="doxyCodeLine"><span class="doxyLineNumber">58</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2f1bfce01580ca2a2b5ff28dd494d956">_pid</a>) {</span></span></div><a id="l00059"></a><div class="doxyCodeLine"><span class="doxyLineNumber">59</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pid-h/#a488a843402f43a41a38d00f0f7d670ac">pid_del_control_block</a>(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2f1bfce01580ca2a2b5ff28dd494d956">_pid</a>);</span></span></div><a id="l00060"></a><div class="doxyCodeLine"><span class="doxyLineNumber">60</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00061"></a><div class="doxyCodeLine"><span class="doxyLineNumber">61</span><span class="doxyLineContent"></span></div><a id="l00062"></a><div class="doxyCodeLine"><span class="doxyLineNumber">62</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a30a1713183fa8219f40e0feb594baeeb">_task</a>) {</span></span></div><a id="l00063"></a><div class="doxyCodeLine"><span class="doxyLineNumber">63</span><span class="doxyLineContent"><span class="doxyHighlight">        vTaskDelete(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a30a1713183fa8219f40e0feb594baeeb">_task</a>);</span></span></div><a id="l00064"></a><div class="doxyCodeLine"><span class="doxyLineNumber">64</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00065"></a><div class="doxyCodeLine"><span class="doxyLineNumber">65</span><span class="doxyLineContent"></span></div><a id="l00066"></a><div class="doxyCodeLine"><span class="doxyLineNumber">66</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Free callback linked lists</span></span></div><a id="l00067"></a><div class="doxyCodeLine"><span class="doxyLineNumber">67</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> free_list = [](<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>* head) {</span></span></div><a id="l00068"></a><div class="doxyCodeLine"><span class="doxyLineNumber">68</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (head) {</span></span></div><a id="l00069"></a><div class="doxyCodeLine"><span class="doxyLineNumber">69</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>* next = head-&gt;<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#accad0c1a0b60149a5399571f2ee68f98">next</a>;</span></span></div><a id="l00070"></a><div class="doxyCodeLine"><span class="doxyLineNumber">70</span><span class="doxyLineContent"><span class="doxyHighlight">            free(head);</span></span></div><a id="l00071"></a><div class="doxyCodeLine"><span class="doxyLineNumber">71</span><span class="doxyLineContent"><span class="doxyHighlight">            head = next;</span></span></div><a id="l00072"></a><div class="doxyCodeLine"><span class="doxyLineNumber">72</span><span class="doxyLineContent"><span class="doxyHighlight">        }</span></span></div><a id="l00073"></a><div class="doxyCodeLine"><span class="doxyLineNumber">73</span><span class="doxyLineContent"><span class="doxyHighlight">    };</span></span></div><a id="l00074"></a><div class="doxyCodeLine"><span class="doxyLineNumber">74</span><span class="doxyLineContent"><span class="doxyHighlight">    free_list(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#acba742ed9f2cf7b804d11e16e249b3cf">_state_cb_head</a>);</span></span></div><a id="l00075"></a><div class="doxyCodeLine"><span class="doxyLineNumber">75</span><span class="doxyLineContent"><span class="doxyHighlight">    free_list(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a169186821a0b503750de39f09b80fdda">_setpoint_cb_head</a>);</span></span></div><a id="l00076"></a><div class="doxyCodeLine"><span class="doxyLineNumber">76</span><span class="doxyLineContent"><span class="doxyHighlight">    free_list(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a510605c27883d35ff298901138b2d5a8">_reached_cb_head</a>);</span></span></div><a id="l00077"></a><div class="doxyCodeLine"><span class="doxyLineNumber">77</span><span class="doxyLineContent"><span class="doxyHighlight">    free_list(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ad4716db19f9d60b0bcb4ae3a3501d6fc">_error_cb_head</a>);</span></span></div><a id="l00078"></a><div class="doxyCodeLine"><span class="doxyLineNumber">78</span><span class="doxyLineContent"></span></div><a id="l00079"></a><div class="doxyCodeLine"><span class="doxyLineNumber">79</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>) {</span></span></div><a id="l00080"></a><div class="doxyCodeLine"><span class="doxyLineNumber">80</span><span class="doxyLineContent"><span class="doxyHighlight">        vSemaphoreDelete(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00081"></a><div class="doxyCodeLine"><span class="doxyLineNumber">81</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00082"></a><div class="doxyCodeLine"><span class="doxyLineNumber">82</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00083"></a><div class="doxyCodeLine"><span class="doxyLineNumber">83</span><span class="doxyLineContent"></span></div><a id="l00084"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#adb90f7bfc9c736fa6d9e6a5701d9ef1b">84</a></span><span class="doxyLineContent"><span class="doxyHighlight"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a5df391269d4b48887d046470bb4adccc">HeaterController::HeaterController</a>(pin_size_t heater_pin, uint32_t freq_hz) : <a href="/desoldering-station-docs/docs/api/classes/heatercontroller">HeaterController</a>() {</span></span></div><a id="l00085"></a><div class="doxyCodeLine"><span class="doxyLineNumber">85</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pwm-h/#ae224bebc0f7366e9e202754b4eae5665">hw_pwm_init</a>(heater_pin, freq_hz, &amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a62562d01f7314375277bc796f49ff6ad">_pwm</a>);</span></span></div><a id="l00086"></a><div class="doxyCodeLine"><span class="doxyLineNumber">86</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pwm-h/#ae224bebc0f7366e9e202754b4eae5665">hw_pwm_init</a>(heater_pin + 1, freq_hz, &amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#afefe5de5f0092483556af39e244b3b99">_pwm2</a>);</span></span></div><a id="l00087"></a><div class="doxyCodeLine"><span class="doxyLineNumber">87</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00088"></a><div class="doxyCodeLine"><span class="doxyLineNumber">88</span><span class="doxyLineContent"></span></div><a id="l00089"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a0d7e66b5ccf627f52e127cd0d005b3a1">89</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ae7e9e63c414e2b98476b2fc2025f5c0d">HeaterController::begin</a>(pin_size_t heater_pin, uint32_t freq_hz) {</span></span></div><a id="l00090"></a><div class="doxyCodeLine"><span class="doxyLineNumber">90</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pwm-h/#ae224bebc0f7366e9e202754b4eae5665">hw_pwm_init</a>(heater_pin, freq_hz, &amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a62562d01f7314375277bc796f49ff6ad">_pwm</a>);</span></span></div><a id="l00091"></a><div class="doxyCodeLine"><span class="doxyLineNumber">91</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pwm-h/#ae224bebc0f7366e9e202754b4eae5665">hw_pwm_init</a>(heater_pin + 1, freq_hz, &amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#afefe5de5f0092483556af39e244b3b99">_pwm2</a>);</span></span></div><a id="l00092"></a><div class="doxyCodeLine"><span class="doxyLineNumber">92</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ae7e9e63c414e2b98476b2fc2025f5c0d">begin</a>();</span></span></div><a id="l00093"></a><div class="doxyCodeLine"><span class="doxyLineNumber">93</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00094"></a><div class="doxyCodeLine"><span class="doxyLineNumber">94</span><span class="doxyLineContent"></span></div><a id="l00095"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ae7e9e63c414e2b98476b2fc2025f5c0d">95</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ae7e9e63c414e2b98476b2fc2025f5c0d">HeaterController::begin</a>() {</span></span></div><a id="l00096"></a><div class="doxyCodeLine"><span class="doxyLineNumber">96</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight">&amp; cfg = <a href="/desoldering-station-docs/docs/api/files/include/include/core/settings-h/#a27b7bb409185752994e0306746f43369">gSettings</a>.<a href="/desoldering-station-docs/docs/api/structs/settings-t/#afc8fbccf40cddd39208556394e375767">heater</a>;</span></span></div><a id="l00097"></a><div class="doxyCodeLine"><span class="doxyLineNumber">97</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pid-h/#a9938dd0fe274d9eae9dcced1ed480650">pid_new_control_block</a>(&amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a>, &amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2f1bfce01580ca2a2b5ff28dd494d956">_pid</a>);</span></span></div><a id="l00098"></a><div class="doxyCodeLine"><span class="doxyLineNumber">98</span><span class="doxyLineContent"></span></div><a id="l00099"></a><div class="doxyCodeLine"><span class="doxyLineNumber">99</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a45b5890f26e022432e617b0c48f780ca">setPWM</a>(0);</span></span></div><a id="l00100"></a><div class="doxyCodeLine"><span class="doxyLineNumber">100</span><span class="doxyLineContent"></span></div><a id="l00101"></a><div class="doxyCodeLine"><span class="doxyLineNumber">101</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a664e6bca22b7d8778d77c2f00a37b823">setPID</a>(cfg.pid.kp, cfg.pid.ki, cfg.pid.kd, cfg.pid.imax, cfg.pid.imin);</span></span></div><a id="l00102"></a><div class="doxyCodeLine"><span class="doxyLineNumber">102</span><span class="doxyLineContent"></span></div><a id="l00103"></a><div class="doxyCodeLine"><span class="doxyLineNumber">103</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aac2b597ae50e80fa44c8411082d9c793">_pump</a>) {</span></span></div><a id="l00104"></a><div class="doxyCodeLine"><span class="doxyLineNumber">104</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h/#a477cf43f079ab4970ac0c4be1c92aa06">PICO_LOGE</a>(<a href="/desoldering-station-docs/docs/api/files/src/src/core/auto-tuner-cpp/#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, </span><span class="doxyHighlightStringLiteral">&quot;Init failed: no PumpController attached&quot;</span><span class="doxyHighlight">);</span></span></div><a id="l00105"></a><div class="doxyCodeLine"><span class="doxyLineNumber">105</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></span></div><a id="l00106"></a><div class="doxyCodeLine"><span class="doxyLineNumber">106</span><span class="doxyLineContent"><span class="doxyHighlight">    } </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> {</span></span></div><a id="l00107"></a><div class="doxyCodeLine"><span class="doxyLineNumber">107</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// _pump-&gt;getMotorDriver().setAccelerationTime(500);</span></span></div><a id="l00108"></a><div class="doxyCodeLine"><span class="doxyLineNumber">108</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aac2b597ae50e80fa44c8411082d9c793">_pump</a>-&gt;<a href="/desoldering-station-docs/docs/api/classes/pumpcontroller/#a009ab177c67e1c4a88c7d88adb545a04">begin</a>();</span></span></div><a id="l00109"></a><div class="doxyCodeLine"><span class="doxyLineNumber">109</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00110"></a><div class="doxyCodeLine"><span class="doxyLineNumber">110</span><span class="doxyLineContent"></span></div><a id="l00111"></a><div class="doxyCodeLine"><span class="doxyLineNumber">111</span><span class="doxyLineContent"></span></div><a id="l00112"></a><div class="doxyCodeLine"><span class="doxyLineNumber">112</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a451e03ac92c9d649abf124d48395aea0">changeState</a>(</span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlight"><a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09d">HeaterState</a></span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(cfg.startup_state));</span></span></div><a id="l00113"></a><div class="doxyCodeLine"><span class="doxyLineNumber">113</span><span class="doxyLineContent"></span></div><a id="l00114"></a><div class="doxyCodeLine"><span class="doxyLineNumber">114</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create heater control task</span></span></div><a id="l00115"></a><div class="doxyCodeLine"><span class="doxyLineNumber">115</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (xTaskCreateAffinitySet(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a989aa47cea863d56b3cf18adbf6d28d1">_heater_task</a>, </span><span class="doxyHighlightStringLiteral">&quot;HeaterCtrl&quot;</span><span class="doxyHighlight">, <a href="/desoldering-station-docs/docs/api/files/include/config-h/#a655da8bd416ba36d0a270d82697f3b8a">CONFIG_HEATER_TASK_STACK_SIZE</a>, </span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">,</span></span></div><a id="l00116"></a><div class="doxyCodeLine"><span class="doxyLineNumber">116</span><span class="doxyLineContent"><span class="doxyHighlight">                               <a href="/desoldering-station-docs/docs/api/files/include/config-h/#adf624a713ab047e2b5e345fc273bfe2d">CONFIG_HEATER_TASK_PRIORITY</a>, <a href="/desoldering-station-docs/docs/api/files/include/config-h/#a4f688424b085a3d7ad71c47be9f666ad">CONFIG_HEATER_TASK_CORE</a>, &amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a30a1713183fa8219f40e0feb594baeeb">_task</a>) != pdPASS) {</span></span></div><a id="l00117"></a><div class="doxyCodeLine"><span class="doxyLineNumber">117</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h/#a477cf43f079ab4970ac0c4be1c92aa06">PICO_LOGE</a>(<a href="/desoldering-station-docs/docs/api/files/src/src/core/auto-tuner-cpp/#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, </span><span class="doxyHighlightStringLiteral">&quot;Failed to create heater control task&quot;</span><span class="doxyHighlight">);</span></span></div><a id="l00118"></a><div class="doxyCodeLine"><span class="doxyLineNumber">118</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></span></div><a id="l00119"></a><div class="doxyCodeLine"><span class="doxyLineNumber">119</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00120"></a><div class="doxyCodeLine"><span class="doxyLineNumber">120</span><span class="doxyLineContent"></span></div><a id="l00121"></a><div class="doxyCodeLine"><span class="doxyLineNumber">121</span><span class="doxyLineContent"></span></div><a id="l00122"></a><div class="doxyCodeLine"><span class="doxyLineNumber">122</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></span></div><a id="l00123"></a><div class="doxyCodeLine"><span class="doxyLineNumber">123</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00124"></a><div class="doxyCodeLine"><span class="doxyLineNumber">124</span><span class="doxyLineContent"></span></div><a id="l00125"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a664e6bca22b7d8778d77c2f00a37b823">125</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a664e6bca22b7d8778d77c2f00a37b823">HeaterController::setPID</a>(</span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> kp, </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> ki, </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> kd) {</span></span></div><a id="l00126"></a><div class="doxyCodeLine"><span class="doxyLineNumber">126</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00127"></a><div class="doxyCodeLine"><span class="doxyLineNumber">127</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a>.<a href="/desoldering-station-docs/docs/api/structs/pid-ctrl-parameter-t/#ae4f749144e4aa235682adc0c6b92b649">kp</a> = kp;</span></span></div><a id="l00128"></a><div class="doxyCodeLine"><span class="doxyLineNumber">128</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a>.<a href="/desoldering-station-docs/docs/api/structs/pid-ctrl-parameter-t/#aef2d4b8e52dbb5f1e6f25435d975f61c">ki</a> = ki;</span></span></div><a id="l00129"></a><div class="doxyCodeLine"><span class="doxyLineNumber">129</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a>.<a href="/desoldering-station-docs/docs/api/structs/pid-ctrl-parameter-t/#a53a3936dd08ef36dfb3c39dbb8d32414">kd</a> = kd;</span></span></div><a id="l00130"></a><div class="doxyCodeLine"><span class="doxyLineNumber">130</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00131"></a><div class="doxyCodeLine"><span class="doxyLineNumber">131</span><span class="doxyLineContent"></span></div><a id="l00132"></a><div class="doxyCodeLine"><span class="doxyLineNumber">132</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pid-h/#ac5e5c05d1c29b859253f501feeb66ab4">pid_update_parameters</a>(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2f1bfce01580ca2a2b5ff28dd494d956">_pid</a>, &amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a>);</span></span></div><a id="l00133"></a><div class="doxyCodeLine"><span class="doxyLineNumber">133</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00134"></a><div class="doxyCodeLine"><span class="doxyLineNumber">134</span><span class="doxyLineContent"></span></div><a id="l00135"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a12844080c3997b1a1d5b2f559bc83200">135</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a664e6bca22b7d8778d77c2f00a37b823">HeaterController::setPID</a>(</span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> kp, </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> ki, </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> kd, </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> imax, </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> imin) {</span></span></div><a id="l00136"></a><div class="doxyCodeLine"><span class="doxyLineNumber">136</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00137"></a><div class="doxyCodeLine"><span class="doxyLineNumber">137</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a>.<a href="/desoldering-station-docs/docs/api/structs/pid-ctrl-parameter-t/#ae4f749144e4aa235682adc0c6b92b649">kp</a>           = kp;</span></span></div><a id="l00138"></a><div class="doxyCodeLine"><span class="doxyLineNumber">138</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a>.<a href="/desoldering-station-docs/docs/api/structs/pid-ctrl-parameter-t/#aef2d4b8e52dbb5f1e6f25435d975f61c">ki</a>           = ki;</span></span></div><a id="l00139"></a><div class="doxyCodeLine"><span class="doxyLineNumber">139</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a>.<a href="/desoldering-station-docs/docs/api/structs/pid-ctrl-parameter-t/#a53a3936dd08ef36dfb3c39dbb8d32414">kd</a>           = kd;</span></span></div><a id="l00140"></a><div class="doxyCodeLine"><span class="doxyLineNumber">140</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a>.<a href="/desoldering-station-docs/docs/api/structs/pid-ctrl-parameter-t/#a6f32862132fa8ecaeb9b08f101cb39ec">max_integral</a> = imax;</span></span></div><a id="l00141"></a><div class="doxyCodeLine"><span class="doxyLineNumber">141</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a>.<a href="/desoldering-station-docs/docs/api/structs/pid-ctrl-parameter-t/#ac9ebf4114e7ab6736c52b8f4ed7e619d">min_integral</a> = imin;</span></span></div><a id="l00142"></a><div class="doxyCodeLine"><span class="doxyLineNumber">142</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00143"></a><div class="doxyCodeLine"><span class="doxyLineNumber">143</span><span class="doxyLineContent"></span></div><a id="l00144"></a><div class="doxyCodeLine"><span class="doxyLineNumber">144</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pid-h/#ac5e5c05d1c29b859253f501feeb66ab4">pid_update_parameters</a>(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2f1bfce01580ca2a2b5ff28dd494d956">_pid</a>, &amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a>);</span></span></div><a id="l00145"></a><div class="doxyCodeLine"><span class="doxyLineNumber">145</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00146"></a><div class="doxyCodeLine"><span class="doxyLineNumber">146</span><span class="doxyLineContent"></span></div><a id="l00147"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a6b797203cb07896521c7beaff4b11db7">147</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a664e6bca22b7d8778d77c2f00a37b823">HeaterController::setPID</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/structs/pid-ctrl-parameter-t">pid_ctrl_parameter_t</a>&amp; params) {</span></span></div><a id="l00148"></a><div class="doxyCodeLine"><span class="doxyLineNumber">148</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00149"></a><div class="doxyCodeLine"><span class="doxyLineNumber">149</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a> = params;</span></span></div><a id="l00150"></a><div class="doxyCodeLine"><span class="doxyLineNumber">150</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00151"></a><div class="doxyCodeLine"><span class="doxyLineNumber">151</span><span class="doxyLineContent"></span></div><a id="l00152"></a><div class="doxyCodeLine"><span class="doxyLineNumber">152</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pid-h/#ac5e5c05d1c29b859253f501feeb66ab4">pid_update_parameters</a>(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2f1bfce01580ca2a2b5ff28dd494d956">_pid</a>, &amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a>);</span></span></div><a id="l00153"></a><div class="doxyCodeLine"><span class="doxyLineNumber">153</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00154"></a><div class="doxyCodeLine"><span class="doxyLineNumber">154</span><span class="doxyLineContent"></span></div><a id="l00155"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a5a55031a5f189e9183f65af52f7caa00">155</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a5a55031a5f189e9183f65af52f7caa00">HeaterController::setPIDLimits</a>(</span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> imax, </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> imin) {</span></span></div><a id="l00156"></a><div class="doxyCodeLine"><span class="doxyLineNumber">156</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00157"></a><div class="doxyCodeLine"><span class="doxyLineNumber">157</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a>.<a href="/desoldering-station-docs/docs/api/structs/pid-ctrl-parameter-t/#a6f32862132fa8ecaeb9b08f101cb39ec">max_integral</a> = imax;</span></span></div><a id="l00158"></a><div class="doxyCodeLine"><span class="doxyLineNumber">158</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a>.<a href="/desoldering-station-docs/docs/api/structs/pid-ctrl-parameter-t/#ac9ebf4114e7ab6736c52b8f4ed7e619d">min_integral</a> = imin;</span></span></div><a id="l00159"></a><div class="doxyCodeLine"><span class="doxyLineNumber">159</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00160"></a><div class="doxyCodeLine"><span class="doxyLineNumber">160</span><span class="doxyLineContent"></span></div><a id="l00161"></a><div class="doxyCodeLine"><span class="doxyLineNumber">161</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pid-h/#ac5e5c05d1c29b859253f501feeb66ab4">pid_update_parameters</a>(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2f1bfce01580ca2a2b5ff28dd494d956">_pid</a>, &amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a25e53e80df07a0e4be188dfecd7e70db">_pid_params</a>);</span></span></div><a id="l00162"></a><div class="doxyCodeLine"><span class="doxyLineNumber">162</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00163"></a><div class="doxyCodeLine"><span class="doxyLineNumber">163</span><span class="doxyLineContent"></span></div><a id="l00164"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a451e03ac92c9d649abf124d48395aea0">164</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a451e03ac92c9d649abf124d48395aea0">HeaterController::changeState</a>(<a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09d">HeaterState</a> new_state) {</span></span></div><a id="l00165"></a><div class="doxyCodeLine"><span class="doxyLineNumber">165</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (new_state == <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a1ac3cab3179638e6089e29ce9183edaa">_pending_state</a>) {</span></span></div><a id="l00166"></a><div class="doxyCodeLine"><span class="doxyLineNumber">166</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></span></div><a id="l00167"></a><div class="doxyCodeLine"><span class="doxyLineNumber">167</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00168"></a><div class="doxyCodeLine"><span class="doxyLineNumber">168</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00169"></a><div class="doxyCodeLine"><span class="doxyLineNumber">169</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a1ac3cab3179638e6089e29ce9183edaa">_pending_state</a> = new_state;</span></span></div><a id="l00170"></a><div class="doxyCodeLine"><span class="doxyLineNumber">170</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00171"></a><div class="doxyCodeLine"><span class="doxyLineNumber">171</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00172"></a><div class="doxyCodeLine"><span class="doxyLineNumber">172</span><span class="doxyLineContent"></span></div><a id="l00173"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#affd49dc66cea740648e5d7180c849eb4">173</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#affd49dc66cea740648e5d7180c849eb4">HeaterController::clearError</a>() {</span></span></div><a id="l00174"></a><div class="doxyCodeLine"><span class="doxyLineNumber">174</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00175"></a><div class="doxyCodeLine"><span class="doxyLineNumber">175</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aab09b4083ffe85dae7daa931cca8a37c">_error</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#ac527554119280137613bf6914e9e528da6adf97f83acf6453d4a6a4b1070f3754">HeaterError::None</a>;</span></span></div><a id="l00176"></a><div class="doxyCodeLine"><span class="doxyLineNumber">176</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a1ac3cab3179638e6089e29ce9183edaa">_pending_state</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da243924bfd56a682be235638b53961e09">HeaterState::Sleep</a>;</span></span></div><a id="l00177"></a><div class="doxyCodeLine"><span class="doxyLineNumber">177</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00178"></a><div class="doxyCodeLine"><span class="doxyLineNumber">178</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00179"></a><div class="doxyCodeLine"><span class="doxyLineNumber">179</span><span class="doxyLineContent"></span></div><a id="l00180"></a><div class="doxyCodeLine"><span class="doxyLineNumber">180</span><span class="doxyLineContent"></span></div><a id="l00181"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#af500143e9a8b1531265240575fed0eb1">181</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#af500143e9a8b1531265240575fed0eb1">HeaterController::setTargetTemperature</a>(uint16_t <a href="/desoldering-station-docs/docs/api/files/src/src/drivers/temperature-c/#afc1d28cfbce795d6ea954ebe725241f5">temperature</a>) {</span></span></div><a id="l00182"></a><div class="doxyCodeLine"><span class="doxyLineNumber">182</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00183"></a><div class="doxyCodeLine"><span class="doxyLineNumber">183</span><span class="doxyLineContent"><span class="doxyHighlight">    uint16_t old_target            = <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#af97bc7ca209a3f52a72d22069d74b567">_target_temperature</a>;</span></span></div><a id="l00184"></a><div class="doxyCodeLine"><span class="doxyLineNumber">184</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#af97bc7ca209a3f52a72d22069d74b567">_target_temperature</a>            = <a href="/desoldering-station-docs/docs/api/files/src/src/drivers/temperature-c/#afc1d28cfbce795d6ea954ebe725241f5">temperature</a>;</span></span></div><a id="l00185"></a><div class="doxyCodeLine"><span class="doxyLineNumber">185</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac4fc6b08b3a6f84ff70312285904338e">_target_temperature_ms</a>         = xTaskGetTickCount();</span></span></div><a id="l00186"></a><div class="doxyCodeLine"><span class="doxyLineNumber">186</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ab2071bebba0c7833e95f725674c09661">_target_temperature_reached</a>    = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></span></div><a id="l00187"></a><div class="doxyCodeLine"><span class="doxyLineNumber">187</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac35d93cdbbeb533e8dbb76e21d42aff6">_target_temperature_reached_ms</a> = 0;</span></span></div><a id="l00188"></a><div class="doxyCodeLine"><span class="doxyLineNumber">188</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aee051ad40053f398eb4710a35a839a47">_heating_start_ms</a>              = xTaskGetTickCount(); </span><span class="doxyHighlightComment">// Reset heating timeout on setpoint change</span></span></div><a id="l00189"></a><div class="doxyCodeLine"><span class="doxyLineNumber">189</span><span class="doxyLineContent"></span></div><a id="l00190"></a><div class="doxyCodeLine"><span class="doxyLineNumber">190</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Auto-transition to Running if setting a valid target and not in Error/Tuning</span></span></div><a id="l00191"></a><div class="doxyCodeLine"><span class="doxyLineNumber">191</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/files/src/src/drivers/temperature-c/#afc1d28cfbce795d6ea954ebe725241f5">temperature</a> &gt;= <a href="/desoldering-station-docs/docs/api/files/include/config-h/#aeadc03eab9d8beccd8909f4a85b7a614">CONFIG_MIN_SET_TEMP</a> &amp;&amp; </span></span></div><a id="l00192"></a><div class="doxyCodeLine"><span class="doxyLineNumber">192</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a> != <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da902b0d55fddef6f8d651fe1035b7d4bd">HeaterState::Error</a> &amp;&amp; </span></span></div><a id="l00193"></a><div class="doxyCodeLine"><span class="doxyLineNumber">193</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a> != <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da89dd2948ecda7325c0001d8a0e51a2d8">HeaterState::Tuning</a>) {</span></span></div><a id="l00194"></a><div class="doxyCodeLine"><span class="doxyLineNumber">194</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a1ac3cab3179638e6089e29ce9183edaa">_pending_state</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da5bda814c4aedb126839228f1a3d92f09">HeaterState::Running</a>;</span></span></div><a id="l00195"></a><div class="doxyCodeLine"><span class="doxyLineNumber">195</span><span class="doxyLineContent"><span class="doxyHighlight">    } </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/files/src/src/drivers/temperature-c/#afc1d28cfbce795d6ea954ebe725241f5">temperature</a> &lt; <a href="/desoldering-station-docs/docs/api/files/include/config-h/#aeadc03eab9d8beccd8909f4a85b7a614">CONFIG_MIN_SET_TEMP</a> &amp;&amp; <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a> == <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da5bda814c4aedb126839228f1a3d92f09">HeaterState::Running</a>) {</span></span></div><a id="l00196"></a><div class="doxyCodeLine"><span class="doxyLineNumber">196</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Turn off if target is below minimum</span></span></div><a id="l00197"></a><div class="doxyCodeLine"><span class="doxyLineNumber">197</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a1ac3cab3179638e6089e29ce9183edaa">_pending_state</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da243924bfd56a682be235638b53961e09">HeaterState::Sleep</a>;</span></span></div><a id="l00198"></a><div class="doxyCodeLine"><span class="doxyLineNumber">198</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00199"></a><div class="doxyCodeLine"><span class="doxyLineNumber">199</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00200"></a><div class="doxyCodeLine"><span class="doxyLineNumber">200</span><span class="doxyLineContent"></span></div><a id="l00201"></a><div class="doxyCodeLine"><span class="doxyLineNumber">201</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Notify setpoint change callbacks (outside mutex)</span></span></div><a id="l00202"></a><div class="doxyCodeLine"><span class="doxyLineNumber">202</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (old_target != <a href="/desoldering-station-docs/docs/api/files/src/src/drivers/temperature-c/#afc1d28cfbce795d6ea954ebe725241f5">temperature</a>) {</span></span></div><a id="l00203"></a><div class="doxyCodeLine"><span class="doxyLineNumber">203</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ab74db0c20ab9b511b167cb681aa8651d">notifySetpointChanged</a>(old_target, <a href="/desoldering-station-docs/docs/api/files/src/src/drivers/temperature-c/#afc1d28cfbce795d6ea954ebe725241f5">temperature</a>);</span></span></div><a id="l00204"></a><div class="doxyCodeLine"><span class="doxyLineNumber">204</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00205"></a><div class="doxyCodeLine"><span class="doxyLineNumber">205</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00206"></a><div class="doxyCodeLine"><span class="doxyLineNumber">206</span><span class="doxyLineContent"></span></div><a id="l00207"></a><div class="doxyCodeLine"><span class="doxyLineNumber">207</span><span class="doxyLineContent"><span class="doxyHighlightComment">// =========== Private Methods ==========</span></span></div><a id="l00208"></a><div class="doxyCodeLine"><span class="doxyLineNumber">208</span><span class="doxyLineContent"></span></div><a id="l00209"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a7a9c8db34b919b1f3b7346e503872040">209</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a7a9c8db34b919b1f3b7346e503872040">HeaterController::setPendingState</a>() {</span></span></div><a id="l00210"></a><div class="doxyCodeLine"><span class="doxyLineNumber">210</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a1ac3cab3179638e6089e29ce9183edaa">_pending_state</a> == <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a>) {</span></span></div><a id="l00211"></a><div class="doxyCodeLine"><span class="doxyLineNumber">211</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></span></div><a id="l00212"></a><div class="doxyCodeLine"><span class="doxyLineNumber">212</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00213"></a><div class="doxyCodeLine"><span class="doxyLineNumber">213</span><span class="doxyLineContent"></span></div><a id="l00214"></a><div class="doxyCodeLine"><span class="doxyLineNumber">214</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09d">HeaterState</a> old_state = <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a>;</span></span></div><a id="l00215"></a><div class="doxyCodeLine"><span class="doxyLineNumber">215</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a>            = <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a1ac3cab3179638e6089e29ce9183edaa">_pending_state</a>;</span></span></div><a id="l00216"></a><div class="doxyCodeLine"><span class="doxyLineNumber">216</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a62fca282f91b4fd726fd4ed3803d2dfe">_state_start_time</a> = xTaskGetTickCount();</span></span></div><a id="l00217"></a><div class="doxyCodeLine"><span class="doxyLineNumber">217</span><span class="doxyLineContent"></span></div><a id="l00218"></a><div class="doxyCodeLine"><span class="doxyLineNumber">218</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h/#ab62a3de8cc9e2daa50ddd66d65d4ab60">PICO_LOGI</a>(<a href="/desoldering-station-docs/docs/api/files/src/src/core/auto-tuner-cpp/#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, </span><span class="doxyHighlightStringLiteral">&quot;State change: %d -&gt; %d&quot;</span><span class="doxyHighlight">, (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight">)old_state, (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight">)<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a>);</span></span></div><a id="l00219"></a><div class="doxyCodeLine"><span class="doxyLineNumber">219</span><span class="doxyLineContent"></span></div><a id="l00220"></a><div class="doxyCodeLine"><span class="doxyLineNumber">220</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Notify state change callbacks</span></span></div><a id="l00221"></a><div class="doxyCodeLine"><span class="doxyLineNumber">221</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a5aef07ef046f0fed247086f4fb37fda1">notifyStateChanged</a>(old_state, <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a>);</span></span></div><a id="l00222"></a><div class="doxyCodeLine"><span class="doxyLineNumber">222</span><span class="doxyLineContent"></span></div><a id="l00223"></a><div class="doxyCodeLine"><span class="doxyLineNumber">223</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a>) {</span></span></div><a id="l00224"></a><div class="doxyCodeLine"><span class="doxyLineNumber">224</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da243924bfd56a682be235638b53961e09">HeaterState::Sleep</a>:</span></span></div><a id="l00225"></a><div class="doxyCodeLine"><span class="doxyLineNumber">225</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac7f015d243f71fe84b7f203c714d7c6b">setPowerPercent</a>(0);</span></span></div><a id="l00226"></a><div class="doxyCodeLine"><span class="doxyLineNumber">226</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pid-h/#a54dce92cfa319be59dabfa5d17b9c08f">pid_reset_ctrl_block</a>(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2f1bfce01580ca2a2b5ff28dd494d956">_pid</a>);</span></span></div><a id="l00227"></a><div class="doxyCodeLine"><span class="doxyLineNumber">227</span><span class="doxyLineContent"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00228"></a><div class="doxyCodeLine"><span class="doxyLineNumber">228</span><span class="doxyLineContent"></span></div><a id="l00229"></a><div class="doxyCodeLine"><span class="doxyLineNumber">229</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da2dbec34a65724db94f81e8533ee18192">HeaterState::Standby</a>:</span></span></div><a id="l00230"></a><div class="doxyCodeLine"><span class="doxyLineNumber">230</span><span class="doxyLineContent"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Set standby temperature from settings</span></span></div><a id="l00231"></a><div class="doxyCodeLine"><span class="doxyLineNumber">231</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#af97bc7ca209a3f52a72d22069d74b567">_target_temperature</a> = <a href="/desoldering-station-docs/docs/api/files/include/include/core/settings-h/#a27b7bb409185752994e0306746f43369">gSettings</a>.<a href="/desoldering-station-docs/docs/api/structs/settings-t/#afc8fbccf40cddd39208556394e375767">heater</a>.<a href="/desoldering-station-docs/docs/api/structs/heater-settings-t/#a49c808e83ab981b511a39fc5d05be174">standby_temperature</a>;</span></span></div><a id="l00232"></a><div class="doxyCodeLine"><span class="doxyLineNumber">232</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ab2071bebba0c7833e95f725674c09661">_target_temperature_reached</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></span></div><a id="l00233"></a><div class="doxyCodeLine"><span class="doxyLineNumber">233</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aee051ad40053f398eb4710a35a839a47">_heating_start_ms</a> = xTaskGetTickCount();</span></span></div><a id="l00234"></a><div class="doxyCodeLine"><span class="doxyLineNumber">234</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pid-h/#a54dce92cfa319be59dabfa5d17b9c08f">pid_reset_ctrl_block</a>(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2f1bfce01580ca2a2b5ff28dd494d956">_pid</a>);</span></span></div><a id="l00235"></a><div class="doxyCodeLine"><span class="doxyLineNumber">235</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h/#ab62a3de8cc9e2daa50ddd66d65d4ab60">PICO_LOGI</a>(<a href="/desoldering-station-docs/docs/api/files/src/src/core/auto-tuner-cpp/#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, </span><span class="doxyHighlightStringLiteral">&quot;Standby: target=%dÂ°C&quot;</span><span class="doxyHighlight">, <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#af97bc7ca209a3f52a72d22069d74b567">_target_temperature</a>);</span></span></div><a id="l00236"></a><div class="doxyCodeLine"><span class="doxyLineNumber">236</span><span class="doxyLineContent"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00237"></a><div class="doxyCodeLine"><span class="doxyLineNumber">237</span><span class="doxyLineContent"></span></div><a id="l00238"></a><div class="doxyCodeLine"><span class="doxyLineNumber">238</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da5bda814c4aedb126839228f1a3d92f09">HeaterState::Running</a>:</span></span></div><a id="l00239"></a><div class="doxyCodeLine"><span class="doxyLineNumber">239</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aee051ad40053f398eb4710a35a839a47">_heating_start_ms</a> = xTaskGetTickCount();</span></span></div><a id="l00240"></a><div class="doxyCodeLine"><span class="doxyLineNumber">240</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ab2071bebba0c7833e95f725674c09661">_target_temperature_reached</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></span></div><a id="l00241"></a><div class="doxyCodeLine"><span class="doxyLineNumber">241</span><span class="doxyLineContent"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00242"></a><div class="doxyCodeLine"><span class="doxyLineNumber">242</span><span class="doxyLineContent"></span></div><a id="l00243"></a><div class="doxyCodeLine"><span class="doxyLineNumber">243</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da902b0d55fddef6f8d651fe1035b7d4bd">HeaterState::Error</a>:</span></span></div><a id="l00244"></a><div class="doxyCodeLine"><span class="doxyLineNumber">244</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac7f015d243f71fe84b7f203c714d7c6b">setPowerPercent</a>(0);</span></span></div><a id="l00245"></a><div class="doxyCodeLine"><span class="doxyLineNumber">245</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pid-h/#a54dce92cfa319be59dabfa5d17b9c08f">pid_reset_ctrl_block</a>(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2f1bfce01580ca2a2b5ff28dd494d956">_pid</a>);</span></span></div><a id="l00246"></a><div class="doxyCodeLine"><span class="doxyLineNumber">246</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h/#a477cf43f079ab4970ac0c4be1c92aa06">PICO_LOGE</a>(<a href="/desoldering-station-docs/docs/api/files/src/src/core/auto-tuner-cpp/#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, </span><span class="doxyHighlightStringLiteral">&quot;Entered ERROR state, error code: %d&quot;</span><span class="doxyHighlight">, (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight">)<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aab09b4083ffe85dae7daa931cca8a37c">_error</a>);</span></span></div><a id="l00247"></a><div class="doxyCodeLine"><span class="doxyLineNumber">247</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a9e7ff8b2b728d249b99f6f2c5aa0be11">notifyError</a>(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aab09b4083ffe85dae7daa931cca8a37c">_error</a>);</span></span></div><a id="l00248"></a><div class="doxyCodeLine"><span class="doxyLineNumber">248</span><span class="doxyLineContent"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00249"></a><div class="doxyCodeLine"><span class="doxyLineNumber">249</span><span class="doxyLineContent"></span></div><a id="l00250"></a><div class="doxyCodeLine"><span class="doxyLineNumber">250</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da89dd2948ecda7325c0001d8a0e51a2d8">HeaterState::Tuning</a>:</span></span></div><a id="l00251"></a><div class="doxyCodeLine"><span class="doxyLineNumber">251</span><span class="doxyLineContent"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// PID tuning mode - manual control</span></span></div><a id="l00252"></a><div class="doxyCodeLine"><span class="doxyLineNumber">252</span><span class="doxyLineContent"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00253"></a><div class="doxyCodeLine"><span class="doxyLineNumber">253</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00254"></a><div class="doxyCodeLine"><span class="doxyLineNumber">254</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00255"></a><div class="doxyCodeLine"><span class="doxyLineNumber">255</span><span class="doxyLineContent"></span></div><a id="l00256"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac7f015d243f71fe84b7f203c714d7c6b">256</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac7f015d243f71fe84b7f203c714d7c6b">HeaterController::setPowerPercent</a>(uint8_t pct) {</span></span></div><a id="l00257"></a><div class="doxyCodeLine"><span class="doxyLineNumber">257</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (pct &gt; 100) {</span></span></div><a id="l00258"></a><div class="doxyCodeLine"><span class="doxyLineNumber">258</span><span class="doxyLineContent"><span class="doxyHighlight">        pct = 100;</span></span></div><a id="l00259"></a><div class="doxyCodeLine"><span class="doxyLineNumber">259</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00260"></a><div class="doxyCodeLine"><span class="doxyLineNumber">260</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a68f7da74a214aa1f41ab4f191923addf">_output_power_pct</a> = pct;</span></span></div><a id="l00261"></a><div class="doxyCodeLine"><span class="doxyLineNumber">261</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00262"></a><div class="doxyCodeLine"><span class="doxyLineNumber">262</span><span class="doxyLineContent"></span></div><a id="l00263"></a><div class="doxyCodeLine"><span class="doxyLineNumber">263</span><span class="doxyLineContent"></span></div><a id="l00264"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a96b732721b05b5cbb2d57d2a837ad64e">264</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a96b732721b05b5cbb2d57d2a837ad64e">HeaterController::setPowerPercentF</a>(</span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> pct) {</span></span></div><a id="l00265"></a><div class="doxyCodeLine"><span class="doxyLineNumber">265</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (pct &lt; 0.0f) {</span></span></div><a id="l00266"></a><div class="doxyCodeLine"><span class="doxyLineNumber">266</span><span class="doxyLineContent"><span class="doxyHighlight">        pct = 0.0f;</span></span></div><a id="l00267"></a><div class="doxyCodeLine"><span class="doxyLineNumber">267</span><span class="doxyLineContent"><span class="doxyHighlight">    } </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (pct &gt; 1.0f) {</span></span></div><a id="l00268"></a><div class="doxyCodeLine"><span class="doxyLineNumber">268</span><span class="doxyLineContent"><span class="doxyHighlight">        pct = 1.0f;</span></span></div><a id="l00269"></a><div class="doxyCodeLine"><span class="doxyLineNumber">269</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00270"></a><div class="doxyCodeLine"><span class="doxyLineNumber">270</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a68f7da74a214aa1f41ab4f191923addf">_output_power_pct</a> = </span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlight">uint8_t</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(pct * 100.0f);</span></span></div><a id="l00271"></a><div class="doxyCodeLine"><span class="doxyLineNumber">271</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00272"></a><div class="doxyCodeLine"><span class="doxyLineNumber">272</span><span class="doxyLineContent"></span></div><a id="l00273"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aff6b47c1a252c851484ce04c06582f5e">273</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aff6b47c1a252c851484ce04c06582f5e">HeaterController::setPowerPercentRelative</a>(int8_t delta_pct) {</span></span></div><a id="l00274"></a><div class="doxyCodeLine"><span class="doxyLineNumber">274</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (delta_pct == 0) {</span></span></div><a id="l00275"></a><div class="doxyCodeLine"><span class="doxyLineNumber">275</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac7f015d243f71fe84b7f203c714d7c6b">setPowerPercent</a>(0);</span></span></div><a id="l00276"></a><div class="doxyCodeLine"><span class="doxyLineNumber">276</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></span></div><a id="l00277"></a><div class="doxyCodeLine"><span class="doxyLineNumber">277</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00278"></a><div class="doxyCodeLine"><span class="doxyLineNumber">278</span><span class="doxyLineContent"><span class="doxyHighlight">    int16_t new_pct = </span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlight">int16_t</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a68f7da74a214aa1f41ab4f191923addf">_output_power_pct</a>) + </span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlight">int16_t</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(delta_pct);</span></span></div><a id="l00279"></a><div class="doxyCodeLine"><span class="doxyLineNumber">279</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (new_pct &lt; 0) {</span></span></div><a id="l00280"></a><div class="doxyCodeLine"><span class="doxyLineNumber">280</span><span class="doxyLineContent"><span class="doxyHighlight">        new_pct = 0;</span></span></div><a id="l00281"></a><div class="doxyCodeLine"><span class="doxyLineNumber">281</span><span class="doxyLineContent"><span class="doxyHighlight">    } </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (new_pct &gt; 100) {</span></span></div><a id="l00282"></a><div class="doxyCodeLine"><span class="doxyLineNumber">282</span><span class="doxyLineContent"><span class="doxyHighlight">        new_pct = 100;</span></span></div><a id="l00283"></a><div class="doxyCodeLine"><span class="doxyLineNumber">283</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00284"></a><div class="doxyCodeLine"><span class="doxyLineNumber">284</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac7f015d243f71fe84b7f203c714d7c6b">setPowerPercent</a>(</span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlight">uint8_t</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(new_pct));</span></span></div><a id="l00285"></a><div class="doxyCodeLine"><span class="doxyLineNumber">285</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00286"></a><div class="doxyCodeLine"><span class="doxyLineNumber">286</span><span class="doxyLineContent"></span></div><a id="l00287"></a><div class="doxyCodeLine"><span class="doxyLineNumber">287</span><span class="doxyLineContent"><span class="doxyHighlightComment">// =========== Callback Registration ===========</span></span></div><a id="l00288"></a><div class="doxyCodeLine"><span class="doxyLineNumber">288</span><span class="doxyLineContent"></span></div><a id="l00289"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a8e7c8f9469afd1c4926321b39c95f1a9">289</a></span><span class="doxyLineContent"><span class="doxyHighlight">heater_cb_handle_t <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a8e7c8f9469afd1c4926321b39c95f1a9">HeaterController::onStateChanged</a>(<a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a2f52ca9a7e38d31e97e39257903fc9c1">heater_state_cb_t</a> cb, </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">* user_data) {</span></span></div><a id="l00290"></a><div class="doxyCodeLine"><span class="doxyLineNumber">290</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!cb) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></span></div><a id="l00291"></a><div class="doxyCodeLine"><span class="doxyLineNumber">291</span><span class="doxyLineContent"></span></div><a id="l00292"></a><div class="doxyCodeLine"><span class="doxyLineNumber">292</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight">* node = </span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlight"><a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>*</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(malloc(</span><span class="doxyHighlightKeyword">sizeof</span><span class="doxyHighlight">(<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>)));</span></span></div><a id="l00293"></a><div class="doxyCodeLine"><span class="doxyLineNumber">293</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!node) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></span></div><a id="l00294"></a><div class="doxyCodeLine"><span class="doxyLineNumber">294</span><span class="doxyLineContent"></span></div><a id="l00295"></a><div class="doxyCodeLine"><span class="doxyLineNumber">295</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#abc184d098cd13a31cb92159220ff99e8">type</a>      = <a href="#a8dc2c250cb794c4483f1d66b87b1b25ba46a2a41cc6e552044816a2d04634545d">HeaterCallbackType::State</a>;</span></span></div><a id="l00296"></a><div class="doxyCodeLine"><span class="doxyLineNumber">296</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;state_cb  = cb;</span></span></div><a id="l00297"></a><div class="doxyCodeLine"><span class="doxyLineNumber">297</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;user_data = user_data;</span></span></div><a id="l00298"></a><div class="doxyCodeLine"><span class="doxyLineNumber">298</span><span class="doxyLineContent"></span></div><a id="l00299"></a><div class="doxyCodeLine"><span class="doxyLineNumber">299</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00300"></a><div class="doxyCodeLine"><span class="doxyLineNumber">300</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;next       = <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#acba742ed9f2cf7b804d11e16e249b3cf">_state_cb_head</a>;</span></span></div><a id="l00301"></a><div class="doxyCodeLine"><span class="doxyLineNumber">301</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#acba742ed9f2cf7b804d11e16e249b3cf">_state_cb_head</a>   = node;</span></span></div><a id="l00302"></a><div class="doxyCodeLine"><span class="doxyLineNumber">302</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00303"></a><div class="doxyCodeLine"><span class="doxyLineNumber">303</span><span class="doxyLineContent"></span></div><a id="l00304"></a><div class="doxyCodeLine"><span class="doxyLineNumber">304</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> node;</span></span></div><a id="l00305"></a><div class="doxyCodeLine"><span class="doxyLineNumber">305</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00306"></a><div class="doxyCodeLine"><span class="doxyLineNumber">306</span><span class="doxyLineContent"></span></div><a id="l00307"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a60b42f36e6b900b2b116d6fd6b074b8f">307</a></span><span class="doxyLineContent"><span class="doxyHighlight">heater_cb_handle_t <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a60b42f36e6b900b2b116d6fd6b074b8f">HeaterController::onSetpointChanged</a>(<a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a7e8532e17ccdc5e249601d94f11d4875">heater_setpoint_cb_t</a> cb, </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">* user_data) {</span></span></div><a id="l00308"></a><div class="doxyCodeLine"><span class="doxyLineNumber">308</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!cb) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></span></div><a id="l00309"></a><div class="doxyCodeLine"><span class="doxyLineNumber">309</span><span class="doxyLineContent"></span></div><a id="l00310"></a><div class="doxyCodeLine"><span class="doxyLineNumber">310</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight">* node = </span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlight"><a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>*</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(malloc(</span><span class="doxyHighlightKeyword">sizeof</span><span class="doxyHighlight">(<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>)));</span></span></div><a id="l00311"></a><div class="doxyCodeLine"><span class="doxyLineNumber">311</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!node) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></span></div><a id="l00312"></a><div class="doxyCodeLine"><span class="doxyLineNumber">312</span><span class="doxyLineContent"></span></div><a id="l00313"></a><div class="doxyCodeLine"><span class="doxyLineNumber">313</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#abc184d098cd13a31cb92159220ff99e8">type</a>        = <a href="#a8dc2c250cb794c4483f1d66b87b1b25ba547dadef6304affc26261ec5ed2f2011">HeaterCallbackType::Setpoint</a>;</span></span></div><a id="l00314"></a><div class="doxyCodeLine"><span class="doxyLineNumber">314</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;setpoint_cb = cb;</span></span></div><a id="l00315"></a><div class="doxyCodeLine"><span class="doxyLineNumber">315</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;user_data   = user_data;</span></span></div><a id="l00316"></a><div class="doxyCodeLine"><span class="doxyLineNumber">316</span><span class="doxyLineContent"></span></div><a id="l00317"></a><div class="doxyCodeLine"><span class="doxyLineNumber">317</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00318"></a><div class="doxyCodeLine"><span class="doxyLineNumber">318</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;next         = <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a169186821a0b503750de39f09b80fdda">_setpoint_cb_head</a>;</span></span></div><a id="l00319"></a><div class="doxyCodeLine"><span class="doxyLineNumber">319</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a169186821a0b503750de39f09b80fdda">_setpoint_cb_head</a>  = node;</span></span></div><a id="l00320"></a><div class="doxyCodeLine"><span class="doxyLineNumber">320</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00321"></a><div class="doxyCodeLine"><span class="doxyLineNumber">321</span><span class="doxyLineContent"></span></div><a id="l00322"></a><div class="doxyCodeLine"><span class="doxyLineNumber">322</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> node;</span></span></div><a id="l00323"></a><div class="doxyCodeLine"><span class="doxyLineNumber">323</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00324"></a><div class="doxyCodeLine"><span class="doxyLineNumber">324</span><span class="doxyLineContent"></span></div><a id="l00325"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ae8dd947c4592ab74a519beb702655de3">325</a></span><span class="doxyLineContent"><span class="doxyHighlight">heater_cb_handle_t <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ae8dd947c4592ab74a519beb702655de3">HeaterController::onSetpointReached</a>(<a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a5078618ec7fb9b02c16ca69c72818492">heater_reached_cb_t</a> cb, </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">* user_data) {</span></span></div><a id="l00326"></a><div class="doxyCodeLine"><span class="doxyLineNumber">326</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!cb) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></span></div><a id="l00327"></a><div class="doxyCodeLine"><span class="doxyLineNumber">327</span><span class="doxyLineContent"></span></div><a id="l00328"></a><div class="doxyCodeLine"><span class="doxyLineNumber">328</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight">* node = </span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlight"><a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>*</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(malloc(</span><span class="doxyHighlightKeyword">sizeof</span><span class="doxyHighlight">(<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>)));</span></span></div><a id="l00329"></a><div class="doxyCodeLine"><span class="doxyLineNumber">329</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!node) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></span></div><a id="l00330"></a><div class="doxyCodeLine"><span class="doxyLineNumber">330</span><span class="doxyLineContent"></span></div><a id="l00331"></a><div class="doxyCodeLine"><span class="doxyLineNumber">331</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#abc184d098cd13a31cb92159220ff99e8">type</a>       = <a href="#a8dc2c250cb794c4483f1d66b87b1b25ba94c32656e1f1acab08c781de14231031">HeaterCallbackType::Reached</a>;</span></span></div><a id="l00332"></a><div class="doxyCodeLine"><span class="doxyLineNumber">332</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;reached_cb = cb;</span></span></div><a id="l00333"></a><div class="doxyCodeLine"><span class="doxyLineNumber">333</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;user_data  = user_data;</span></span></div><a id="l00334"></a><div class="doxyCodeLine"><span class="doxyLineNumber">334</span><span class="doxyLineContent"></span></div><a id="l00335"></a><div class="doxyCodeLine"><span class="doxyLineNumber">335</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00336"></a><div class="doxyCodeLine"><span class="doxyLineNumber">336</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;next         = <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a510605c27883d35ff298901138b2d5a8">_reached_cb_head</a>;</span></span></div><a id="l00337"></a><div class="doxyCodeLine"><span class="doxyLineNumber">337</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a510605c27883d35ff298901138b2d5a8">_reached_cb_head</a>   = node;</span></span></div><a id="l00338"></a><div class="doxyCodeLine"><span class="doxyLineNumber">338</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00339"></a><div class="doxyCodeLine"><span class="doxyLineNumber">339</span><span class="doxyLineContent"></span></div><a id="l00340"></a><div class="doxyCodeLine"><span class="doxyLineNumber">340</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> node;</span></span></div><a id="l00341"></a><div class="doxyCodeLine"><span class="doxyLineNumber">341</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00342"></a><div class="doxyCodeLine"><span class="doxyLineNumber">342</span><span class="doxyLineContent"></span></div><a id="l00343"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac6548b4febccbd46b793168b85f31f1a">343</a></span><span class="doxyLineContent"><span class="doxyHighlight">heater_cb_handle_t <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac6548b4febccbd46b793168b85f31f1a">HeaterController::onError</a>(<a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a4f38f774f4f56ed0c7f0648209eb366f">heater_error_cb_t</a> cb, </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">* user_data) {</span></span></div><a id="l00344"></a><div class="doxyCodeLine"><span class="doxyLineNumber">344</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!cb) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></span></div><a id="l00345"></a><div class="doxyCodeLine"><span class="doxyLineNumber">345</span><span class="doxyLineContent"></span></div><a id="l00346"></a><div class="doxyCodeLine"><span class="doxyLineNumber">346</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight">* node = </span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlight"><a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>*</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(malloc(</span><span class="doxyHighlightKeyword">sizeof</span><span class="doxyHighlight">(<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>)));</span></span></div><a id="l00347"></a><div class="doxyCodeLine"><span class="doxyLineNumber">347</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!node) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></span></div><a id="l00348"></a><div class="doxyCodeLine"><span class="doxyLineNumber">348</span><span class="doxyLineContent"></span></div><a id="l00349"></a><div class="doxyCodeLine"><span class="doxyLineNumber">349</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#abc184d098cd13a31cb92159220ff99e8">type</a>     = <a href="#a8dc2c250cb794c4483f1d66b87b1b25ba902b0d55fddef6f8d651fe1035b7d4bd">HeaterCallbackType::Error</a>;</span></span></div><a id="l00350"></a><div class="doxyCodeLine"><span class="doxyLineNumber">350</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;error_cb = cb;</span></span></div><a id="l00351"></a><div class="doxyCodeLine"><span class="doxyLineNumber">351</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;user_data = user_data;</span></span></div><a id="l00352"></a><div class="doxyCodeLine"><span class="doxyLineNumber">352</span><span class="doxyLineContent"></span></div><a id="l00353"></a><div class="doxyCodeLine"><span class="doxyLineNumber">353</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00354"></a><div class="doxyCodeLine"><span class="doxyLineNumber">354</span><span class="doxyLineContent"><span class="doxyHighlight">    node-&gt;next       = <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ad4716db19f9d60b0bcb4ae3a3501d6fc">_error_cb_head</a>;</span></span></div><a id="l00355"></a><div class="doxyCodeLine"><span class="doxyLineNumber">355</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ad4716db19f9d60b0bcb4ae3a3501d6fc">_error_cb_head</a>   = node;</span></span></div><a id="l00356"></a><div class="doxyCodeLine"><span class="doxyLineNumber">356</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00357"></a><div class="doxyCodeLine"><span class="doxyLineNumber">357</span><span class="doxyLineContent"></span></div><a id="l00358"></a><div class="doxyCodeLine"><span class="doxyLineNumber">358</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> node;</span></span></div><a id="l00359"></a><div class="doxyCodeLine"><span class="doxyLineNumber">359</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00360"></a><div class="doxyCodeLine"><span class="doxyLineNumber">360</span><span class="doxyLineContent"></span></div><a id="l00361"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abed4b17df02b4de5cc1f83351e3bb11c">361</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abed4b17df02b4de5cc1f83351e3bb11c">HeaterController::removeCallback</a>(heater_cb_handle_t handle) {</span></span></div><a id="l00362"></a><div class="doxyCodeLine"><span class="doxyLineNumber">362</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!handle) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></span></div><a id="l00363"></a><div class="doxyCodeLine"><span class="doxyLineNumber">363</span><span class="doxyLineContent"></span></div><a id="l00364"></a><div class="doxyCodeLine"><span class="doxyLineNumber">364</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00365"></a><div class="doxyCodeLine"><span class="doxyLineNumber">365</span><span class="doxyLineContent"></span></div><a id="l00366"></a><div class="doxyCodeLine"><span class="doxyLineNumber">366</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Determine which list to search based on callback type</span></span></div><a id="l00367"></a><div class="doxyCodeLine"><span class="doxyLineNumber">367</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>** head_ptr = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></span></div><a id="l00368"></a><div class="doxyCodeLine"><span class="doxyLineNumber">368</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (handle-&gt;type) {</span></span></div><a id="l00369"></a><div class="doxyCodeLine"><span class="doxyLineNumber">369</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="#a8dc2c250cb794c4483f1d66b87b1b25ba46a2a41cc6e552044816a2d04634545d">HeaterCallbackType::State</a>:    head_ptr = &amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#acba742ed9f2cf7b804d11e16e249b3cf">_state_cb_head</a>;    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00370"></a><div class="doxyCodeLine"><span class="doxyLineNumber">370</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="#a8dc2c250cb794c4483f1d66b87b1b25ba547dadef6304affc26261ec5ed2f2011">HeaterCallbackType::Setpoint</a>: head_ptr = &amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a169186821a0b503750de39f09b80fdda">_setpoint_cb_head</a>; </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00371"></a><div class="doxyCodeLine"><span class="doxyLineNumber">371</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="#a8dc2c250cb794c4483f1d66b87b1b25ba94c32656e1f1acab08c781de14231031">HeaterCallbackType::Reached</a>:  head_ptr = &amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a510605c27883d35ff298901138b2d5a8">_reached_cb_head</a>;  </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00372"></a><div class="doxyCodeLine"><span class="doxyLineNumber">372</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="#a8dc2c250cb794c4483f1d66b87b1b25ba902b0d55fddef6f8d651fe1035b7d4bd">HeaterCallbackType::Error</a>:    head_ptr = &amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ad4716db19f9d60b0bcb4ae3a3501d6fc">_error_cb_head</a>;    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00373"></a><div class="doxyCodeLine"><span class="doxyLineNumber">373</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00374"></a><div class="doxyCodeLine"><span class="doxyLineNumber">374</span><span class="doxyLineContent"></span></div><a id="l00375"></a><div class="doxyCodeLine"><span class="doxyLineNumber">375</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (head_ptr) {</span></span></div><a id="l00376"></a><div class="doxyCodeLine"><span class="doxyLineNumber">376</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>** curr = head_ptr;</span></span></div><a id="l00377"></a><div class="doxyCodeLine"><span class="doxyLineNumber">377</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (*curr) {</span></span></div><a id="l00378"></a><div class="doxyCodeLine"><span class="doxyLineNumber">378</span><span class="doxyLineContent"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (*curr == handle) {</span></span></div><a id="l00379"></a><div class="doxyCodeLine"><span class="doxyLineNumber">379</span><span class="doxyLineContent"><span class="doxyHighlight">                *curr = handle-&gt;<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#accad0c1a0b60149a5399571f2ee68f98">next</a>;</span></span></div><a id="l00380"></a><div class="doxyCodeLine"><span class="doxyLineNumber">380</span><span class="doxyLineContent"><span class="doxyHighlight">                free(handle);</span></span></div><a id="l00381"></a><div class="doxyCodeLine"><span class="doxyLineNumber">381</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00382"></a><div class="doxyCodeLine"><span class="doxyLineNumber">382</span><span class="doxyLineContent"><span class="doxyHighlight">            }</span></span></div><a id="l00383"></a><div class="doxyCodeLine"><span class="doxyLineNumber">383</span><span class="doxyLineContent"><span class="doxyHighlight">            curr = &amp;((*curr)-&gt;next);</span></span></div><a id="l00384"></a><div class="doxyCodeLine"><span class="doxyLineNumber">384</span><span class="doxyLineContent"><span class="doxyHighlight">        }</span></span></div><a id="l00385"></a><div class="doxyCodeLine"><span class="doxyLineNumber">385</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00386"></a><div class="doxyCodeLine"><span class="doxyLineNumber">386</span><span class="doxyLineContent"></span></div><a id="l00387"></a><div class="doxyCodeLine"><span class="doxyLineNumber">387</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00388"></a><div class="doxyCodeLine"><span class="doxyLineNumber">388</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00389"></a><div class="doxyCodeLine"><span class="doxyLineNumber">389</span><span class="doxyLineContent"></span></div><a id="l00390"></a><div class="doxyCodeLine"><span class="doxyLineNumber">390</span><span class="doxyLineContent"><span class="doxyHighlightComment">// =========== Callback Notification Helpers ===========</span></span></div><a id="l00391"></a><div class="doxyCodeLine"><span class="doxyLineNumber">391</span><span class="doxyLineContent"></span></div><a id="l00392"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a5aef07ef046f0fed247086f4fb37fda1">392</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a5aef07ef046f0fed247086f4fb37fda1">HeaterController::notifyStateChanged</a>(<a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09d">HeaterState</a> old_state, <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09d">HeaterState</a> new_state) {</span></span></div><a id="l00393"></a><div class="doxyCodeLine"><span class="doxyLineNumber">393</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Take snapshot of callback list under mutex to allow safe iteration</span></span></div><a id="l00394"></a><div class="doxyCodeLine"><span class="doxyLineNumber">394</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// while permitting concurrent registration/removal</span></span></div><a id="l00395"></a><div class="doxyCodeLine"><span class="doxyLineNumber">395</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00396"></a><div class="doxyCodeLine"><span class="doxyLineNumber">396</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>* node = <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#acba742ed9f2cf7b804d11e16e249b3cf">_state_cb_head</a>;</span></span></div><a id="l00397"></a><div class="doxyCodeLine"><span class="doxyLineNumber">397</span><span class="doxyLineContent"></span></div><a id="l00398"></a><div class="doxyCodeLine"><span class="doxyLineNumber">398</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Count nodes for stack allocation</span></span></div><a id="l00399"></a><div class="doxyCodeLine"><span class="doxyLineNumber">399</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> count = 0;</span></span></div><a id="l00400"></a><div class="doxyCodeLine"><span class="doxyLineNumber">400</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>* n = node; n; n = n-&gt;<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#accad0c1a0b60149a5399571f2ee68f98">next</a>) count++;</span></span></div><a id="l00401"></a><div class="doxyCodeLine"><span class="doxyLineNumber">401</span><span class="doxyLineContent"></span></div><a id="l00402"></a><div class="doxyCodeLine"><span class="doxyLineNumber">402</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (count == 0) {</span></span></div><a id="l00403"></a><div class="doxyCodeLine"><span class="doxyLineNumber">403</span><span class="doxyLineContent"><span class="doxyHighlight">        xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00404"></a><div class="doxyCodeLine"><span class="doxyLineNumber">404</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></span></div><a id="l00405"></a><div class="doxyCodeLine"><span class="doxyLineNumber">405</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00406"></a><div class="doxyCodeLine"><span class="doxyLineNumber">406</span><span class="doxyLineContent"></span></div><a id="l00407"></a><div class="doxyCodeLine"><span class="doxyLineNumber">407</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Copy callback info to stack (avoid heap allocation in hot path)</span></span></div><a id="l00408"></a><div class="doxyCodeLine"><span class="doxyLineNumber">408</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Max 8 callbacks per event type to keep stack usage bounded</span></span></div><a id="l00409"></a><div class="doxyCodeLine"><span class="doxyLineNumber">409</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">constexpr</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> MAX_CBS = 8;</span></span></div><a id="l00410"></a><div class="doxyCodeLine"><span class="doxyLineNumber">410</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight">{ <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a2f52ca9a7e38d31e97e39257903fc9c1">heater_state_cb_t</a> cb; </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">* data; } snapshot[MAX_CBS];</span></span></div><a id="l00411"></a><div class="doxyCodeLine"><span class="doxyLineNumber">411</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> snapshot_count = 0;</span></span></div><a id="l00412"></a><div class="doxyCodeLine"><span class="doxyLineNumber">412</span><span class="doxyLineContent"></span></div><a id="l00413"></a><div class="doxyCodeLine"><span class="doxyLineNumber">413</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>* n = node; n &amp;&amp; snapshot_count &lt; MAX_CBS; n = n-&gt;<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#accad0c1a0b60149a5399571f2ee68f98">next</a>) {</span></span></div><a id="l00414"></a><div class="doxyCodeLine"><span class="doxyLineNumber">414</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (n-&gt;state_cb) {</span></span></div><a id="l00415"></a><div class="doxyCodeLine"><span class="doxyLineNumber">415</span><span class="doxyLineContent"><span class="doxyHighlight">            snapshot[snapshot_count].cb   = n-&gt;state_cb;</span></span></div><a id="l00416"></a><div class="doxyCodeLine"><span class="doxyLineNumber">416</span><span class="doxyLineContent"><span class="doxyHighlight">            snapshot[snapshot_count].data = n-&gt;user_data;</span></span></div><a id="l00417"></a><div class="doxyCodeLine"><span class="doxyLineNumber">417</span><span class="doxyLineContent"><span class="doxyHighlight">            snapshot_count++;</span></span></div><a id="l00418"></a><div class="doxyCodeLine"><span class="doxyLineNumber">418</span><span class="doxyLineContent"><span class="doxyHighlight">        }</span></span></div><a id="l00419"></a><div class="doxyCodeLine"><span class="doxyLineNumber">419</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00420"></a><div class="doxyCodeLine"><span class="doxyLineNumber">420</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00421"></a><div class="doxyCodeLine"><span class="doxyLineNumber">421</span><span class="doxyLineContent"></span></div><a id="l00422"></a><div class="doxyCodeLine"><span class="doxyLineNumber">422</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Invoke callbacks outside mutex - won&#x27;t block heater control</span></span></div><a id="l00423"></a><div class="doxyCodeLine"><span class="doxyLineNumber">423</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> i = 0; i &lt; snapshot_count; i++) {</span></span></div><a id="l00424"></a><div class="doxyCodeLine"><span class="doxyLineNumber">424</span><span class="doxyLineContent"><span class="doxyHighlight">        snapshot[i].cb(old_state, new_state, snapshot[i].data);</span></span></div><a id="l00425"></a><div class="doxyCodeLine"><span class="doxyLineNumber">425</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00426"></a><div class="doxyCodeLine"><span class="doxyLineNumber">426</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00427"></a><div class="doxyCodeLine"><span class="doxyLineNumber">427</span><span class="doxyLineContent"></span></div><a id="l00428"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ab74db0c20ab9b511b167cb681aa8651d">428</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ab74db0c20ab9b511b167cb681aa8651d">HeaterController::notifySetpointChanged</a>(uint16_t old_setpoint, uint16_t new_setpoint) {</span></span></div><a id="l00429"></a><div class="doxyCodeLine"><span class="doxyLineNumber">429</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00430"></a><div class="doxyCodeLine"><span class="doxyLineNumber">430</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>* node = <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a169186821a0b503750de39f09b80fdda">_setpoint_cb_head</a>;</span></span></div><a id="l00431"></a><div class="doxyCodeLine"><span class="doxyLineNumber">431</span><span class="doxyLineContent"></span></div><a id="l00432"></a><div class="doxyCodeLine"><span class="doxyLineNumber">432</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> count = 0;</span></span></div><a id="l00433"></a><div class="doxyCodeLine"><span class="doxyLineNumber">433</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>* n = node; n; n = n-&gt;<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#accad0c1a0b60149a5399571f2ee68f98">next</a>) count++;</span></span></div><a id="l00434"></a><div class="doxyCodeLine"><span class="doxyLineNumber">434</span><span class="doxyLineContent"></span></div><a id="l00435"></a><div class="doxyCodeLine"><span class="doxyLineNumber">435</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (count == 0) {</span></span></div><a id="l00436"></a><div class="doxyCodeLine"><span class="doxyLineNumber">436</span><span class="doxyLineContent"><span class="doxyHighlight">        xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00437"></a><div class="doxyCodeLine"><span class="doxyLineNumber">437</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></span></div><a id="l00438"></a><div class="doxyCodeLine"><span class="doxyLineNumber">438</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00439"></a><div class="doxyCodeLine"><span class="doxyLineNumber">439</span><span class="doxyLineContent"></span></div><a id="l00440"></a><div class="doxyCodeLine"><span class="doxyLineNumber">440</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">constexpr</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> MAX_CBS = 8;</span></span></div><a id="l00441"></a><div class="doxyCodeLine"><span class="doxyLineNumber">441</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight">{ <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a7e8532e17ccdc5e249601d94f11d4875">heater_setpoint_cb_t</a> cb; </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">* data; } snapshot[MAX_CBS];</span></span></div><a id="l00442"></a><div class="doxyCodeLine"><span class="doxyLineNumber">442</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> snapshot_count = 0;</span></span></div><a id="l00443"></a><div class="doxyCodeLine"><span class="doxyLineNumber">443</span><span class="doxyLineContent"></span></div><a id="l00444"></a><div class="doxyCodeLine"><span class="doxyLineNumber">444</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>* n = node; n &amp;&amp; snapshot_count &lt; MAX_CBS; n = n-&gt;<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#accad0c1a0b60149a5399571f2ee68f98">next</a>) {</span></span></div><a id="l00445"></a><div class="doxyCodeLine"><span class="doxyLineNumber">445</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (n-&gt;setpoint_cb) {</span></span></div><a id="l00446"></a><div class="doxyCodeLine"><span class="doxyLineNumber">446</span><span class="doxyLineContent"><span class="doxyHighlight">            snapshot[snapshot_count].cb   = n-&gt;setpoint_cb;</span></span></div><a id="l00447"></a><div class="doxyCodeLine"><span class="doxyLineNumber">447</span><span class="doxyLineContent"><span class="doxyHighlight">            snapshot[snapshot_count].data = n-&gt;user_data;</span></span></div><a id="l00448"></a><div class="doxyCodeLine"><span class="doxyLineNumber">448</span><span class="doxyLineContent"><span class="doxyHighlight">            snapshot_count++;</span></span></div><a id="l00449"></a><div class="doxyCodeLine"><span class="doxyLineNumber">449</span><span class="doxyLineContent"><span class="doxyHighlight">        }</span></span></div><a id="l00450"></a><div class="doxyCodeLine"><span class="doxyLineNumber">450</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00451"></a><div class="doxyCodeLine"><span class="doxyLineNumber">451</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00452"></a><div class="doxyCodeLine"><span class="doxyLineNumber">452</span><span class="doxyLineContent"></span></div><a id="l00453"></a><div class="doxyCodeLine"><span class="doxyLineNumber">453</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> i = 0; i &lt; snapshot_count; i++) {</span></span></div><a id="l00454"></a><div class="doxyCodeLine"><span class="doxyLineNumber">454</span><span class="doxyLineContent"><span class="doxyHighlight">        snapshot[i].cb(old_setpoint, new_setpoint, snapshot[i].data);</span></span></div><a id="l00455"></a><div class="doxyCodeLine"><span class="doxyLineNumber">455</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00456"></a><div class="doxyCodeLine"><span class="doxyLineNumber">456</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00457"></a><div class="doxyCodeLine"><span class="doxyLineNumber">457</span><span class="doxyLineContent"></span></div><a id="l00458"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ab3c7390e2287b6afa9059d8ff80e960f">458</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ab3c7390e2287b6afa9059d8ff80e960f">HeaterController::notifySetpointReached</a>(uint16_t <a href="/desoldering-station-docs/docs/api/files/src/src/drivers/temperature-c/#afc1d28cfbce795d6ea954ebe725241f5">temperature</a>) {</span></span></div><a id="l00459"></a><div class="doxyCodeLine"><span class="doxyLineNumber">459</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00460"></a><div class="doxyCodeLine"><span class="doxyLineNumber">460</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>* node = <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a510605c27883d35ff298901138b2d5a8">_reached_cb_head</a>;</span></span></div><a id="l00461"></a><div class="doxyCodeLine"><span class="doxyLineNumber">461</span><span class="doxyLineContent"></span></div><a id="l00462"></a><div class="doxyCodeLine"><span class="doxyLineNumber">462</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> count = 0;</span></span></div><a id="l00463"></a><div class="doxyCodeLine"><span class="doxyLineNumber">463</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>* n = node; n; n = n-&gt;<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#accad0c1a0b60149a5399571f2ee68f98">next</a>) count++;</span></span></div><a id="l00464"></a><div class="doxyCodeLine"><span class="doxyLineNumber">464</span><span class="doxyLineContent"></span></div><a id="l00465"></a><div class="doxyCodeLine"><span class="doxyLineNumber">465</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (count == 0) {</span></span></div><a id="l00466"></a><div class="doxyCodeLine"><span class="doxyLineNumber">466</span><span class="doxyLineContent"><span class="doxyHighlight">        xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00467"></a><div class="doxyCodeLine"><span class="doxyLineNumber">467</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></span></div><a id="l00468"></a><div class="doxyCodeLine"><span class="doxyLineNumber">468</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00469"></a><div class="doxyCodeLine"><span class="doxyLineNumber">469</span><span class="doxyLineContent"></span></div><a id="l00470"></a><div class="doxyCodeLine"><span class="doxyLineNumber">470</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">constexpr</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> MAX_CBS = 8;</span></span></div><a id="l00471"></a><div class="doxyCodeLine"><span class="doxyLineNumber">471</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight">{ <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a5078618ec7fb9b02c16ca69c72818492">heater_reached_cb_t</a> cb; </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">* data; } snapshot[MAX_CBS];</span></span></div><a id="l00472"></a><div class="doxyCodeLine"><span class="doxyLineNumber">472</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> snapshot_count = 0;</span></span></div><a id="l00473"></a><div class="doxyCodeLine"><span class="doxyLineNumber">473</span><span class="doxyLineContent"></span></div><a id="l00474"></a><div class="doxyCodeLine"><span class="doxyLineNumber">474</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>* n = node; n &amp;&amp; snapshot_count &lt; MAX_CBS; n = n-&gt;<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#accad0c1a0b60149a5399571f2ee68f98">next</a>) {</span></span></div><a id="l00475"></a><div class="doxyCodeLine"><span class="doxyLineNumber">475</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (n-&gt;reached_cb) {</span></span></div><a id="l00476"></a><div class="doxyCodeLine"><span class="doxyLineNumber">476</span><span class="doxyLineContent"><span class="doxyHighlight">            snapshot[snapshot_count].cb   = n-&gt;reached_cb;</span></span></div><a id="l00477"></a><div class="doxyCodeLine"><span class="doxyLineNumber">477</span><span class="doxyLineContent"><span class="doxyHighlight">            snapshot[snapshot_count].data = n-&gt;user_data;</span></span></div><a id="l00478"></a><div class="doxyCodeLine"><span class="doxyLineNumber">478</span><span class="doxyLineContent"><span class="doxyHighlight">            snapshot_count++;</span></span></div><a id="l00479"></a><div class="doxyCodeLine"><span class="doxyLineNumber">479</span><span class="doxyLineContent"><span class="doxyHighlight">        }</span></span></div><a id="l00480"></a><div class="doxyCodeLine"><span class="doxyLineNumber">480</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00481"></a><div class="doxyCodeLine"><span class="doxyLineNumber">481</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00482"></a><div class="doxyCodeLine"><span class="doxyLineNumber">482</span><span class="doxyLineContent"></span></div><a id="l00483"></a><div class="doxyCodeLine"><span class="doxyLineNumber">483</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> i = 0; i &lt; snapshot_count; i++) {</span></span></div><a id="l00484"></a><div class="doxyCodeLine"><span class="doxyLineNumber">484</span><span class="doxyLineContent"><span class="doxyHighlight">        snapshot[i].cb(<a href="/desoldering-station-docs/docs/api/files/src/src/drivers/temperature-c/#afc1d28cfbce795d6ea954ebe725241f5">temperature</a>, snapshot[i].data);</span></span></div><a id="l00485"></a><div class="doxyCodeLine"><span class="doxyLineNumber">485</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00486"></a><div class="doxyCodeLine"><span class="doxyLineNumber">486</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00487"></a><div class="doxyCodeLine"><span class="doxyLineNumber">487</span><span class="doxyLineContent"></span></div><a id="l00488"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a9e7ff8b2b728d249b99f6f2c5aa0be11">488</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a9e7ff8b2b728d249b99f6f2c5aa0be11">HeaterController::notifyError</a>(<a href="/desoldering-station-docs/docs/api/files/include/heater-h/#ac527554119280137613bf6914e9e528d">HeaterError</a> error) {</span></span></div><a id="l00489"></a><div class="doxyCodeLine"><span class="doxyLineNumber">489</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00490"></a><div class="doxyCodeLine"><span class="doxyLineNumber">490</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>* node = <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ad4716db19f9d60b0bcb4ae3a3501d6fc">_error_cb_head</a>;</span></span></div><a id="l00491"></a><div class="doxyCodeLine"><span class="doxyLineNumber">491</span><span class="doxyLineContent"></span></div><a id="l00492"></a><div class="doxyCodeLine"><span class="doxyLineNumber">492</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> count = 0;</span></span></div><a id="l00493"></a><div class="doxyCodeLine"><span class="doxyLineNumber">493</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>* n = node; n; n = n-&gt;<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#accad0c1a0b60149a5399571f2ee68f98">next</a>) count++;</span></span></div><a id="l00494"></a><div class="doxyCodeLine"><span class="doxyLineNumber">494</span><span class="doxyLineContent"></span></div><a id="l00495"></a><div class="doxyCodeLine"><span class="doxyLineNumber">495</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (count == 0) {</span></span></div><a id="l00496"></a><div class="doxyCodeLine"><span class="doxyLineNumber">496</span><span class="doxyLineContent"><span class="doxyHighlight">        xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00497"></a><div class="doxyCodeLine"><span class="doxyLineNumber">497</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></span></div><a id="l00498"></a><div class="doxyCodeLine"><span class="doxyLineNumber">498</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00499"></a><div class="doxyCodeLine"><span class="doxyLineNumber">499</span><span class="doxyLineContent"></span></div><a id="l00500"></a><div class="doxyCodeLine"><span class="doxyLineNumber">500</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">constexpr</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> MAX_CBS = 8;</span></span></div><a id="l00501"></a><div class="doxyCodeLine"><span class="doxyLineNumber">501</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight">{ <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a4f38f774f4f56ed0c7f0648209eb366f">heater_error_cb_t</a> cb; </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">* data; } snapshot[MAX_CBS];</span></span></div><a id="l00502"></a><div class="doxyCodeLine"><span class="doxyLineNumber">502</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> snapshot_count = 0;</span></span></div><a id="l00503"></a><div class="doxyCodeLine"><span class="doxyLineNumber">503</span><span class="doxyLineContent"></span></div><a id="l00504"></a><div class="doxyCodeLine"><span class="doxyLineNumber">504</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node">heater_cb_node</a>* n = node; n &amp;&amp; snapshot_count &lt; MAX_CBS; n = n-&gt;<a href="/desoldering-station-docs/docs/api/structs/heater-cb-node/#accad0c1a0b60149a5399571f2ee68f98">next</a>) {</span></span></div><a id="l00505"></a><div class="doxyCodeLine"><span class="doxyLineNumber">505</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (n-&gt;error_cb) {</span></span></div><a id="l00506"></a><div class="doxyCodeLine"><span class="doxyLineNumber">506</span><span class="doxyLineContent"><span class="doxyHighlight">            snapshot[snapshot_count].cb   = n-&gt;error_cb;</span></span></div><a id="l00507"></a><div class="doxyCodeLine"><span class="doxyLineNumber">507</span><span class="doxyLineContent"><span class="doxyHighlight">            snapshot[snapshot_count].data = n-&gt;user_data;</span></span></div><a id="l00508"></a><div class="doxyCodeLine"><span class="doxyLineNumber">508</span><span class="doxyLineContent"><span class="doxyHighlight">            snapshot_count++;</span></span></div><a id="l00509"></a><div class="doxyCodeLine"><span class="doxyLineNumber">509</span><span class="doxyLineContent"><span class="doxyHighlight">        }</span></span></div><a id="l00510"></a><div class="doxyCodeLine"><span class="doxyLineNumber">510</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00511"></a><div class="doxyCodeLine"><span class="doxyLineNumber">511</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00512"></a><div class="doxyCodeLine"><span class="doxyLineNumber">512</span><span class="doxyLineContent"></span></div><a id="l00513"></a><div class="doxyCodeLine"><span class="doxyLineNumber">513</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">size_t</span><span class="doxyHighlight"> i = 0; i &lt; snapshot_count; i++) {</span></span></div><a id="l00514"></a><div class="doxyCodeLine"><span class="doxyLineNumber">514</span><span class="doxyLineContent"><span class="doxyHighlight">        snapshot[i].cb(error, snapshot[i].data);</span></span></div><a id="l00515"></a><div class="doxyCodeLine"><span class="doxyLineNumber">515</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00516"></a><div class="doxyCodeLine"><span class="doxyLineNumber">516</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00517"></a><div class="doxyCodeLine"><span class="doxyLineNumber">517</span><span class="doxyLineContent"></span></div><a id="l00518"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a45b5890f26e022432e617b0c48f780ca">518</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a45b5890f26e022432e617b0c48f780ca">HeaterController::setPWM</a>(uint8_t pct) {</span></span></div><a id="l00519"></a><div class="doxyCodeLine"><span class="doxyLineNumber">519</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> duty;</span></span></div><a id="l00520"></a><div class="doxyCodeLine"><span class="doxyLineNumber">520</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (pct &gt; 100) {</span></span></div><a id="l00521"></a><div class="doxyCodeLine"><span class="doxyLineNumber">521</span><span class="doxyLineContent"><span class="doxyHighlight">        pct = 100;</span></span></div><a id="l00522"></a><div class="doxyCodeLine"><span class="doxyLineNumber">522</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00523"></a><div class="doxyCodeLine"><span class="doxyLineNumber">523</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (pct == 0) {</span></span></div><a id="l00524"></a><div class="doxyCodeLine"><span class="doxyLineNumber">524</span><span class="doxyLineContent"><span class="doxyHighlight">        duty = 1.0f;</span></span></div><a id="l00525"></a><div class="doxyCodeLine"><span class="doxyLineNumber">525</span><span class="doxyLineContent"><span class="doxyHighlight">    } </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> {</span></span></div><a id="l00526"></a><div class="doxyCodeLine"><span class="doxyLineNumber">526</span><span class="doxyLineContent"><span class="doxyHighlight">        duty = 1.f - (</span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(pct) / 100.0f);</span></span></div><a id="l00527"></a><div class="doxyCodeLine"><span class="doxyLineNumber">527</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00528"></a><div class="doxyCodeLine"><span class="doxyLineNumber">528</span><span class="doxyLineContent"></span></div><a id="l00529"></a><div class="doxyCodeLine"><span class="doxyLineNumber">529</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pwm-h/#a5a50760b0ac068115ac737c274f75772">hw_pwm_set_duty</a>(&amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a62562d01f7314375277bc796f49ff6ad">_pwm</a>, duty);</span></span></div><a id="l00530"></a><div class="doxyCodeLine"><span class="doxyLineNumber">530</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pwm-h/#a5a50760b0ac068115ac737c274f75772">hw_pwm_set_duty</a>(&amp;<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#afefe5de5f0092483556af39e244b3b99">_pwm2</a>, duty);</span></span></div><a id="l00531"></a><div class="doxyCodeLine"><span class="doxyLineNumber">531</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00532"></a><div class="doxyCodeLine"><span class="doxyLineNumber">532</span><span class="doxyLineContent"></span></div><a id="l00533"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a6972427204a4328e3b525131a1ced1a6">533</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a6972427204a4328e3b525131a1ced1a6">HeaterController::triggerActivity</a>() {</span></span></div><a id="l00534"></a><div class="doxyCodeLine"><span class="doxyLineNumber">534</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreTake(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>, portMAX_DELAY);</span></span></div><a id="l00535"></a><div class="doxyCodeLine"><span class="doxyLineNumber">535</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2b4634d628a0eef6045119de2f84e3f3">_last_activity_ms</a> = xTaskGetTickCount();</span></span></div><a id="l00536"></a><div class="doxyCodeLine"><span class="doxyLineNumber">536</span><span class="doxyLineContent"></span></div><a id="l00537"></a><div class="doxyCodeLine"><span class="doxyLineNumber">537</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Wake from sleep/standby to running if appropriate</span></span></div><a id="l00538"></a><div class="doxyCodeLine"><span class="doxyLineNumber">538</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a> == <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da243924bfd56a682be235638b53961e09">HeaterState::Sleep</a> || <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a> == <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da2dbec34a65724db94f81e8533ee18192">HeaterState::Standby</a>) {</span></span></div><a id="l00539"></a><div class="doxyCodeLine"><span class="doxyLineNumber">539</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#af97bc7ca209a3f52a72d22069d74b567">_target_temperature</a> &gt;= <a href="/desoldering-station-docs/docs/api/files/include/config-h/#aeadc03eab9d8beccd8909f4a85b7a614">CONFIG_MIN_SET_TEMP</a> &amp;&amp; <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aab09b4083ffe85dae7daa931cca8a37c">_error</a> == <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#ac527554119280137613bf6914e9e528da6adf97f83acf6453d4a6a4b1070f3754">HeaterError::None</a>) {</span></span></div><a id="l00540"></a><div class="doxyCodeLine"><span class="doxyLineNumber">540</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a1ac3cab3179638e6089e29ce9183edaa">_pending_state</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da5bda814c4aedb126839228f1a3d92f09">HeaterState::Running</a>;</span></span></div><a id="l00541"></a><div class="doxyCodeLine"><span class="doxyLineNumber">541</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h/#ab62a3de8cc9e2daa50ddd66d65d4ab60">PICO_LOGI</a>(<a href="/desoldering-station-docs/docs/api/files/src/src/core/auto-tuner-cpp/#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, </span><span class="doxyHighlightStringLiteral">&quot;Activity triggered, waking to Running state&quot;</span><span class="doxyHighlight">);</span></span></div><a id="l00542"></a><div class="doxyCodeLine"><span class="doxyLineNumber">542</span><span class="doxyLineContent"><span class="doxyHighlight">        }</span></span></div><a id="l00543"></a><div class="doxyCodeLine"><span class="doxyLineNumber">543</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00544"></a><div class="doxyCodeLine"><span class="doxyLineNumber">544</span><span class="doxyLineContent"></span></div><a id="l00545"></a><div class="doxyCodeLine"><span class="doxyLineNumber">545</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Reset the target reached timestamp to extend standby timeout</span></span></div><a id="l00546"></a><div class="doxyCodeLine"><span class="doxyLineNumber">546</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a> == <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da5bda814c4aedb126839228f1a3d92f09">HeaterState::Running</a> &amp;&amp; <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ab2071bebba0c7833e95f725674c09661">_target_temperature_reached</a>) {</span></span></div><a id="l00547"></a><div class="doxyCodeLine"><span class="doxyLineNumber">547</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac35d93cdbbeb533e8dbb76e21d42aff6">_target_temperature_reached_ms</a> = xTaskGetTickCount();</span></span></div><a id="l00548"></a><div class="doxyCodeLine"><span class="doxyLineNumber">548</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00549"></a><div class="doxyCodeLine"><span class="doxyLineNumber">549</span><span class="doxyLineContent"><span class="doxyHighlight">    xSemaphoreGive(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#abb0bb3c731a98834e4b5768647516668">_mutex</a>);</span></span></div><a id="l00550"></a><div class="doxyCodeLine"><span class="doxyLineNumber">550</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00551"></a><div class="doxyCodeLine"><span class="doxyLineNumber">551</span><span class="doxyLineContent"></span></div><a id="l00552"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ace6229947b7b7d14b5452d4aafe371bc">552</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ace6229947b7b7d14b5452d4aafe371bc">HeaterController::detectErrors</a>(uint16_t current_temp, </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> raw_temp, uint32_t now) {</span></span></div><a id="l00553"></a><div class="doxyCodeLine"><span class="doxyLineNumber">553</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip most error detection during tuning - only overtemperature is critical</span></span></div><a id="l00554"></a><div class="doxyCodeLine"><span class="doxyLineNumber">554</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> is_tuning = (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a> == <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da89dd2948ecda7325c0001d8a0e51a2d8">HeaterState::Tuning</a>);</span></span></div><a id="l00555"></a><div class="doxyCodeLine"><span class="doxyLineNumber">555</span><span class="doxyLineContent"></span></div><a id="l00556"></a><div class="doxyCodeLine"><span class="doxyLineNumber">556</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check for no handle connected</span></span></div><a id="l00557"></a><div class="doxyCodeLine"><span class="doxyLineNumber">557</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (raw_temp &lt;= <a href="/desoldering-station-docs/docs/api/files/include/config-h/#a084af286bfc018121c989b57ae547e97">CONFIG_HEATER_NO_HANDLE_TEMP</a> + 100) {</span></span></div><a id="l00558"></a><div class="doxyCodeLine"><span class="doxyLineNumber">558</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a7ccdb82507a7420c6e0cfdd5d0f1c191">_handle_connected</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></span></div><a id="l00559"></a><div class="doxyCodeLine"><span class="doxyLineNumber">559</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!is_tuning &amp;&amp; (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a> == <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da5bda814c4aedb126839228f1a3d92f09">HeaterState::Running</a> || <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a> == <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da2dbec34a65724db94f81e8533ee18192">HeaterState::Standby</a>)) {</span></span></div><a id="l00560"></a><div class="doxyCodeLine"><span class="doxyLineNumber">560</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aab09b4083ffe85dae7daa931cca8a37c">_error</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#ac527554119280137613bf6914e9e528da66919d9215202785857501718b6fd028">HeaterError::NoHandle</a>;</span></span></div><a id="l00561"></a><div class="doxyCodeLine"><span class="doxyLineNumber">561</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a1ac3cab3179638e6089e29ce9183edaa">_pending_state</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da902b0d55fddef6f8d651fe1035b7d4bd">HeaterState::Error</a>;</span></span></div><a id="l00562"></a><div class="doxyCodeLine"><span class="doxyLineNumber">562</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h/#a477cf43f079ab4970ac0c4be1c92aa06">PICO_LOGE</a>(<a href="/desoldering-station-docs/docs/api/files/src/src/core/auto-tuner-cpp/#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, </span><span class="doxyHighlightStringLiteral">&quot;No handle detected&quot;</span><span class="doxyHighlight">);</span></span></div><a id="l00563"></a><div class="doxyCodeLine"><span class="doxyLineNumber">563</span><span class="doxyLineContent"><span class="doxyHighlight">        }</span></span></div><a id="l00564"></a><div class="doxyCodeLine"><span class="doxyLineNumber">564</span><span class="doxyLineContent"><span class="doxyHighlight">    } </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> {</span></span></div><a id="l00565"></a><div class="doxyCodeLine"><span class="doxyLineNumber">565</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a7ccdb82507a7420c6e0cfdd5d0f1c191">_handle_connected</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></span></div><a id="l00566"></a><div class="doxyCodeLine"><span class="doxyLineNumber">566</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00567"></a><div class="doxyCodeLine"><span class="doxyLineNumber">567</span><span class="doxyLineContent"></span></div><a id="l00568"></a><div class="doxyCodeLine"><span class="doxyLineNumber">568</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check for sensor failure (out of valid range) - skip during tuning</span></span></div><a id="l00569"></a><div class="doxyCodeLine"><span class="doxyLineNumber">569</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!is_tuning &amp;&amp; <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a7ccdb82507a7420c6e0cfdd5d0f1c191">_handle_connected</a> &amp;&amp; </span></span></div><a id="l00570"></a><div class="doxyCodeLine"><span class="doxyLineNumber">570</span><span class="doxyLineContent"><span class="doxyHighlight">        (raw_temp &lt; CONFIG_HEATER_SENSOR_MIN_TEMP || raw_temp &gt; <a href="/desoldering-station-docs/docs/api/files/include/config-h/#a90e93c4bf0b328be00c6f1b9be42f479">CONFIG_HEATER_SENSOR_MAX_TEMP</a>)) {</span></span></div><a id="l00571"></a><div class="doxyCodeLine"><span class="doxyLineNumber">571</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a> != <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da243924bfd56a682be235638b53961e09">HeaterState::Sleep</a> &amp;&amp; <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a> != <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da902b0d55fddef6f8d651fe1035b7d4bd">HeaterState::Error</a>) {</span></span></div><a id="l00572"></a><div class="doxyCodeLine"><span class="doxyLineNumber">572</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aab09b4083ffe85dae7daa931cca8a37c">_error</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#ac527554119280137613bf6914e9e528da4f5ea289ea6867cf33c2d3ef77d72f05">HeaterError::SensorFailure</a>;</span></span></div><a id="l00573"></a><div class="doxyCodeLine"><span class="doxyLineNumber">573</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a1ac3cab3179638e6089e29ce9183edaa">_pending_state</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da902b0d55fddef6f8d651fe1035b7d4bd">HeaterState::Error</a>;</span></span></div><a id="l00574"></a><div class="doxyCodeLine"><span class="doxyLineNumber">574</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h/#a477cf43f079ab4970ac0c4be1c92aa06">PICO_LOGE</a>(<a href="/desoldering-station-docs/docs/api/files/src/src/core/auto-tuner-cpp/#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, </span><span class="doxyHighlightStringLiteral">&quot;Sensor failure: temp=%.1f&quot;</span><span class="doxyHighlight">, raw_temp);</span></span></div><a id="l00575"></a><div class="doxyCodeLine"><span class="doxyLineNumber">575</span><span class="doxyLineContent"><span class="doxyHighlight">        }</span></span></div><a id="l00576"></a><div class="doxyCodeLine"><span class="doxyLineNumber">576</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00577"></a><div class="doxyCodeLine"><span class="doxyLineNumber">577</span><span class="doxyLineContent"></span></div><a id="l00578"></a><div class="doxyCodeLine"><span class="doxyLineNumber">578</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check for overtemperature - always check, even during tuning (safety critical)</span></span></div><a id="l00579"></a><div class="doxyCodeLine"><span class="doxyLineNumber">579</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (current_temp &gt; <a href="/desoldering-station-docs/docs/api/files/include/config-h/#aa603d54de65e46c890f061c57d26a98b">CONFIG_HEATER_OVERTEMP_THRESHOLD</a>) {</span></span></div><a id="l00580"></a><div class="doxyCodeLine"><span class="doxyLineNumber">580</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a> != <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da902b0d55fddef6f8d651fe1035b7d4bd">HeaterState::Error</a>) {</span></span></div><a id="l00581"></a><div class="doxyCodeLine"><span class="doxyLineNumber">581</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aab09b4083ffe85dae7daa931cca8a37c">_error</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#ac527554119280137613bf6914e9e528dae1024c64ffe0cecc833b9789e76f5430">HeaterError::Overtemperature</a>;</span></span></div><a id="l00582"></a><div class="doxyCodeLine"><span class="doxyLineNumber">582</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a1ac3cab3179638e6089e29ce9183edaa">_pending_state</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da902b0d55fddef6f8d651fe1035b7d4bd">HeaterState::Error</a>;</span></span></div><a id="l00583"></a><div class="doxyCodeLine"><span class="doxyLineNumber">583</span><span class="doxyLineContent"><span class="doxyHighlight">            <a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h/#a477cf43f079ab4970ac0c4be1c92aa06">PICO_LOGE</a>(<a href="/desoldering-station-docs/docs/api/files/src/src/core/auto-tuner-cpp/#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, </span><span class="doxyHighlightStringLiteral">&quot;Overtemperature: %dÂ°C&quot;</span><span class="doxyHighlight">, current_temp);</span></span></div><a id="l00584"></a><div class="doxyCodeLine"><span class="doxyLineNumber">584</span><span class="doxyLineContent"><span class="doxyHighlight">        }</span></span></div><a id="l00585"></a><div class="doxyCodeLine"><span class="doxyLineNumber">585</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00586"></a><div class="doxyCodeLine"><span class="doxyLineNumber">586</span><span class="doxyLineContent"></span></div><a id="l00587"></a><div class="doxyCodeLine"><span class="doxyLineNumber">587</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Runaway detection (temperature rising too fast when not heating)</span></span></div><a id="l00588"></a><div class="doxyCodeLine"><span class="doxyLineNumber">588</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip during first 3 seconds after boot to allow ADC to stabilize</span></span></div><a id="l00589"></a><div class="doxyCodeLine"><span class="doxyLineNumber">589</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> uint32_t boot_time = xTaskGetTickCount();</span></span></div><a id="l00590"></a><div class="doxyCodeLine"><span class="doxyLineNumber">590</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> past_startup = (now - boot_time) &gt; pdMS_TO_TICKS(3000);</span></span></div><a id="l00591"></a><div class="doxyCodeLine"><span class="doxyLineNumber">591</span><span class="doxyLineContent"></span></div><a id="l00592"></a><div class="doxyCodeLine"><span class="doxyLineNumber">592</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a> == <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da243924bfd56a682be235638b53961e09">HeaterState::Sleep</a> &amp;&amp; <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a7ccdb82507a7420c6e0cfdd5d0f1c191">_handle_connected</a> &amp;&amp; past_startup &amp;&amp; </span></span></div><a id="l00593"></a><div class="doxyCodeLine"><span class="doxyLineNumber">593</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a7dfc74d0b9ffa2a5b9de0a9cf61ea512">_last_temp_check_ms</a> &gt; 0 &amp;&amp; <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ad253b9665de45e09a932992303efe74b">_last_temp</a> &gt; 0) {</span></span></div><a id="l00594"></a><div class="doxyCodeLine"><span class="doxyLineNumber">594</span><span class="doxyLineContent"><span class="doxyHighlight">        uint32_t dt_ms = (now - <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a7dfc74d0b9ffa2a5b9de0a9cf61ea512">_last_temp_check_ms</a>) * portTICK_PERIOD_MS;</span></span></div><a id="l00595"></a><div class="doxyCodeLine"><span class="doxyLineNumber">595</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (dt_ms &gt; 50 &amp;&amp; dt_ms &lt; 500) { </span><span class="doxyHighlightComment">// Only check with reasonable time deltas</span></span></div><a id="l00596"></a><div class="doxyCodeLine"><span class="doxyLineNumber">596</span><span class="doxyLineContent"><span class="doxyHighlight">            int16_t temp_diff = current_temp - <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ad253b9665de45e09a932992303efe74b">_last_temp</a>;</span></span></div><a id="l00597"></a><div class="doxyCodeLine"><span class="doxyLineNumber">597</span><span class="doxyLineContent"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (temp_diff &gt; 0) { </span><span class="doxyHighlightComment">// Only check rising temperature</span></span></div><a id="l00598"></a><div class="doxyCodeLine"><span class="doxyLineNumber">598</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> rate = (float)temp_diff * 1000.0f / (</span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight">)dt_ms; </span><span class="doxyHighlightComment">// Â°C per second</span></span></div><a id="l00599"></a><div class="doxyCodeLine"><span class="doxyLineNumber">599</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (rate &gt; <a href="/desoldering-station-docs/docs/api/files/include/config-h/#ac74f1e4633f6c08c3b36cca4c47b5006">CONFIG_HEATER_RUNAWAY_RATE</a>) {</span></span></div><a id="l00600"></a><div class="doxyCodeLine"><span class="doxyLineNumber">600</span><span class="doxyLineContent"><span class="doxyHighlight">                    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aab09b4083ffe85dae7daa931cca8a37c">_error</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#ac527554119280137613bf6914e9e528da7f11739b2e0fcbbbc59614c4e604b897">HeaterError::RunawayHeating</a>;</span></span></div><a id="l00601"></a><div class="doxyCodeLine"><span class="doxyLineNumber">601</span><span class="doxyLineContent"><span class="doxyHighlight">                    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a1ac3cab3179638e6089e29ce9183edaa">_pending_state</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da902b0d55fddef6f8d651fe1035b7d4bd">HeaterState::Error</a>;</span></span></div><a id="l00602"></a><div class="doxyCodeLine"><span class="doxyLineNumber">602</span><span class="doxyLineContent"><span class="doxyHighlight">                    <a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h/#a477cf43f079ab4970ac0c4be1c92aa06">PICO_LOGE</a>(<a href="/desoldering-station-docs/docs/api/files/src/src/core/auto-tuner-cpp/#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, </span><span class="doxyHighlightStringLiteral">&quot;Runaway heating detected: %.1fÂ°C/s&quot;</span><span class="doxyHighlight">, rate);</span></span></div><a id="l00603"></a><div class="doxyCodeLine"><span class="doxyLineNumber">603</span><span class="doxyLineContent"><span class="doxyHighlight">                }</span></span></div><a id="l00604"></a><div class="doxyCodeLine"><span class="doxyLineNumber">604</span><span class="doxyLineContent"><span class="doxyHighlight">            }</span></span></div><a id="l00605"></a><div class="doxyCodeLine"><span class="doxyLineNumber">605</span><span class="doxyLineContent"><span class="doxyHighlight">        }</span></span></div><a id="l00606"></a><div class="doxyCodeLine"><span class="doxyLineNumber">606</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00607"></a><div class="doxyCodeLine"><span class="doxyLineNumber">607</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div><a id="l00608"></a><div class="doxyCodeLine"><span class="doxyLineNumber">608</span><span class="doxyLineContent"></span></div><a id="l00609"></a><div class="doxyCodeLine"><span class="doxyLineNumber"><a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a335f6c999504989a02b9952fcade2de0">609</a></span><span class="doxyLineContent"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a335f6c999504989a02b9952fcade2de0">HeaterController::update</a>() {</span></span></div><a id="l00610"></a><div class="doxyCodeLine"><span class="doxyLineNumber">610</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> pid_input_err = 0.0f;</span></span></div><a id="l00611"></a><div class="doxyCodeLine"><span class="doxyLineNumber">611</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> pid_output    = 0.0f;</span></span></div><a id="l00612"></a><div class="doxyCodeLine"><span class="doxyLineNumber">612</span><span class="doxyLineContent"></span></div><a id="l00613"></a><div class="doxyCodeLine"><span class="doxyLineNumber">613</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Initialize activity timestamp</span></span></div><a id="l00614"></a><div class="doxyCodeLine"><span class="doxyLineNumber">614</span><span class="doxyLineContent"><span class="doxyHighlight">    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2b4634d628a0eef6045119de2f84e3f3">_last_activity_ms</a> = xTaskGetTickCount();</span></span></div><a id="l00615"></a><div class="doxyCodeLine"><span class="doxyLineNumber">615</span><span class="doxyLineContent"></span></div><a id="l00616"></a><div class="doxyCodeLine"><span class="doxyLineNumber">616</span><span class="doxyLineContent"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (;;) {</span></span></div><a id="l00617"></a><div class="doxyCodeLine"><span class="doxyLineNumber">617</span><span class="doxyLineContent"><span class="doxyHighlight">        uint32_t now = xTaskGetTickCount();</span></span></div><a id="l00618"></a><div class="doxyCodeLine"><span class="doxyLineNumber">618</span><span class="doxyLineContent"></span></div><a id="l00619"></a><div class="doxyCodeLine"><span class="doxyLineNumber">619</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Apply any pending state change</span></span></div><a id="l00620"></a><div class="doxyCodeLine"><span class="doxyLineNumber">620</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a7a9c8db34b919b1f3b7346e503872040">setPendingState</a>();</span></span></div><a id="l00621"></a><div class="doxyCodeLine"><span class="doxyLineNumber">621</span><span class="doxyLineContent"></span></div><a id="l00622"></a><div class="doxyCodeLine"><span class="doxyLineNumber">622</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Read temperatures</span></span></div><a id="l00623"></a><div class="doxyCodeLine"><span class="doxyLineNumber">623</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> raw_heater_temp = <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/temperature-h/#af5c2d8e27894c19fe36fcd3ac0700e0a">read_heater_temperature_celsius</a>();</span></span></div><a id="l00624"></a><div class="doxyCodeLine"><span class="doxyLineNumber">624</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> filtered_temp   = <a href="/desoldering-station-docs/docs/api/files/include/include/drivers/temperature-h/#ab72b2e6689039a5da935217396f968d7">read_heater_temperature_filtered</a>();</span></span></div><a id="l00625"></a><div class="doxyCodeLine"><span class="doxyLineNumber">625</span><span class="doxyLineContent"><span class="doxyHighlight">        uint16_t current_temp = </span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlight">uint16_t</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(filtered_temp);</span></span></div><a id="l00626"></a><div class="doxyCodeLine"><span class="doxyLineNumber">626</span><span class="doxyLineContent"></span></div><a id="l00627"></a><div class="doxyCodeLine"><span class="doxyLineNumber">627</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Error detection</span></span></div><a id="l00628"></a><div class="doxyCodeLine"><span class="doxyLineNumber">628</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ace6229947b7b7d14b5452d4aafe371bc">detectErrors</a>(current_temp, raw_heater_temp, now);</span></span></div><a id="l00629"></a><div class="doxyCodeLine"><span class="doxyLineNumber">629</span><span class="doxyLineContent"></span></div><a id="l00630"></a><div class="doxyCodeLine"><span class="doxyLineNumber">630</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// ===== State Machine =====</span></span></div><a id="l00631"></a><div class="doxyCodeLine"><span class="doxyLineNumber">631</span><span class="doxyLineContent"></span></div><a id="l00632"></a><div class="doxyCodeLine"><span class="doxyLineNumber">632</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a4def8dba8f866554858c628125d727fa">_state</a>) {</span></span></div><a id="l00633"></a><div class="doxyCodeLine"><span class="doxyLineNumber">633</span><span class="doxyLineContent"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da243924bfd56a682be235638b53961e09">HeaterState::Sleep</a>:</span></span></div><a id="l00634"></a><div class="doxyCodeLine"><span class="doxyLineNumber">634</span><span class="doxyLineContent"><span class="doxyHighlight">                <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac7f015d243f71fe84b7f203c714d7c6b">setPowerPercent</a>(0);</span></span></div><a id="l00635"></a><div class="doxyCodeLine"><span class="doxyLineNumber">635</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00636"></a><div class="doxyCodeLine"><span class="doxyLineNumber">636</span><span class="doxyLineContent"></span></div><a id="l00637"></a><div class="doxyCodeLine"><span class="doxyLineNumber">637</span><span class="doxyLineContent"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da5bda814c4aedb126839228f1a3d92f09">HeaterState::Running</a>: {</span></span></div><a id="l00638"></a><div class="doxyCodeLine"><span class="doxyLineNumber">638</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightComment">// Check for heating timeout (configurable) - only when actually heating up</span></span></div><a id="l00639"></a><div class="doxyCodeLine"><span class="doxyLineNumber">639</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ab2071bebba0c7833e95f725674c09661">_target_temperature_reached</a> &amp;&amp; <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#af97bc7ca209a3f52a72d22069d74b567">_target_temperature</a> &gt; current_temp) {</span></span></div><a id="l00640"></a><div class="doxyCodeLine"><span class="doxyLineNumber">640</span><span class="doxyLineContent"><span class="doxyHighlight">                    uint32_t heating_elapsed = now - <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aee051ad40053f398eb4710a35a839a47">_heating_start_ms</a>;</span></span></div><a id="l00641"></a><div class="doxyCodeLine"><span class="doxyLineNumber">641</span><span class="doxyLineContent"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (heating_elapsed &gt; pdMS_TO_TICKS(<a href="/desoldering-station-docs/docs/api/files/include/include/core/settings-h/#a27b7bb409185752994e0306746f43369">gSettings</a>.<a href="/desoldering-station-docs/docs/api/structs/settings-t/#afc8fbccf40cddd39208556394e375767">heater</a>.<a href="/desoldering-station-docs/docs/api/structs/heater-settings-t/#a9775a45ee60af5570ef40b501014b199">heating_timeout_ms</a>)) {</span></span></div><a id="l00642"></a><div class="doxyCodeLine"><span class="doxyLineNumber">642</span><span class="doxyLineContent"><span class="doxyHighlight">                        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aab09b4083ffe85dae7daa931cca8a37c">_error</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#ac527554119280137613bf6914e9e528dac83f1505949efbd38b0cdaa10336f083">HeaterError::HeatingTimeout</a>;</span></span></div><a id="l00643"></a><div class="doxyCodeLine"><span class="doxyLineNumber">643</span><span class="doxyLineContent"><span class="doxyHighlight">                        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a1ac3cab3179638e6089e29ce9183edaa">_pending_state</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da902b0d55fddef6f8d651fe1035b7d4bd">HeaterState::Error</a>;</span></span></div><a id="l00644"></a><div class="doxyCodeLine"><span class="doxyLineNumber">644</span><span class="doxyLineContent"><span class="doxyHighlight">                        <a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h/#a477cf43f079ab4970ac0c4be1c92aa06">PICO_LOGE</a>(<a href="/desoldering-station-docs/docs/api/files/src/src/core/auto-tuner-cpp/#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, </span><span class="doxyHighlightStringLiteral">&quot;Heating timeout: failed to reach %dÂ°C&quot;</span><span class="doxyHighlight">, <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#af97bc7ca209a3f52a72d22069d74b567">_target_temperature</a>);</span></span></div><a id="l00645"></a><div class="doxyCodeLine"><span class="doxyLineNumber">645</span><span class="doxyLineContent"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00646"></a><div class="doxyCodeLine"><span class="doxyLineNumber">646</span><span class="doxyLineContent"><span class="doxyHighlight">                    }</span></span></div><a id="l00647"></a><div class="doxyCodeLine"><span class="doxyLineNumber">647</span><span class="doxyLineContent"><span class="doxyHighlight">                }</span></span></div><a id="l00648"></a><div class="doxyCodeLine"><span class="doxyLineNumber">648</span><span class="doxyLineContent"></span></div><a id="l00649"></a><div class="doxyCodeLine"><span class="doxyLineNumber">649</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightComment">// Standby timeout after reaching temperature (based on last activity)</span></span></div><a id="l00650"></a><div class="doxyCodeLine"><span class="doxyLineNumber">650</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ab2071bebba0c7833e95f725674c09661">_target_temperature_reached</a>) {</span></span></div><a id="l00651"></a><div class="doxyCodeLine"><span class="doxyLineNumber">651</span><span class="doxyLineContent"><span class="doxyHighlight">                    uint32_t idle_time = now - <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2b4634d628a0eef6045119de2f84e3f3">_last_activity_ms</a>;</span></span></div><a id="l00652"></a><div class="doxyCodeLine"><span class="doxyLineNumber">652</span><span class="doxyLineContent"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (idle_time &gt; pdMS_TO_TICKS(<a href="/desoldering-station-docs/docs/api/files/include/include/core/settings-h/#a27b7bb409185752994e0306746f43369">gSettings</a>.<a href="/desoldering-station-docs/docs/api/structs/settings-t/#afc8fbccf40cddd39208556394e375767">heater</a>.<a href="/desoldering-station-docs/docs/api/structs/heater-settings-t/#a3eb3dbc0575d5a255d6c5162e610d2d5">standby_timeout_ms</a>)) {</span></span></div><a id="l00653"></a><div class="doxyCodeLine"><span class="doxyLineNumber">653</span><span class="doxyLineContent"><span class="doxyHighlight">                        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a1ac3cab3179638e6089e29ce9183edaa">_pending_state</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da2dbec34a65724db94f81e8533ee18192">HeaterState::Standby</a>;</span></span></div><a id="l00654"></a><div class="doxyCodeLine"><span class="doxyLineNumber">654</span><span class="doxyLineContent"><span class="doxyHighlight">                        <a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h/#ab62a3de8cc9e2daa50ddd66d65d4ab60">PICO_LOGI</a>(<a href="/desoldering-station-docs/docs/api/files/src/src/core/auto-tuner-cpp/#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, </span><span class="doxyHighlightStringLiteral">&quot;Standby timeout, entering standby&quot;</span><span class="doxyHighlight">);</span></span></div><a id="l00655"></a><div class="doxyCodeLine"><span class="doxyLineNumber">655</span><span class="doxyLineContent"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00656"></a><div class="doxyCodeLine"><span class="doxyLineNumber">656</span><span class="doxyLineContent"><span class="doxyHighlight">                    }</span></span></div><a id="l00657"></a><div class="doxyCodeLine"><span class="doxyLineNumber">657</span><span class="doxyLineContent"><span class="doxyHighlight">                }</span></span></div><a id="l00658"></a><div class="doxyCodeLine"><span class="doxyLineNumber">658</span><span class="doxyLineContent"></span></div><a id="l00659"></a><div class="doxyCodeLine"><span class="doxyLineNumber">659</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightComment">// PID control</span></span></div><a id="l00660"></a><div class="doxyCodeLine"><span class="doxyLineNumber">660</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#af97bc7ca209a3f52a72d22069d74b567">_target_temperature</a> &gt;= <a href="/desoldering-station-docs/docs/api/files/include/config-h/#aeadc03eab9d8beccd8909f4a85b7a614">CONFIG_MIN_SET_TEMP</a> &amp;&amp; current_temp &lt;= <a href="/desoldering-station-docs/docs/api/files/include/config-h/#a0bce3768ad4c423453cc46856a29ca1c">CONFIG_MAX_SET_TEMP</a>) {</span></span></div><a id="l00661"></a><div class="doxyCodeLine"><span class="doxyLineNumber">661</span><span class="doxyLineContent"><span class="doxyHighlight">                    pid_input_err = </span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#af97bc7ca209a3f52a72d22069d74b567">_target_temperature</a> - current_temp);</span></span></div><a id="l00662"></a><div class="doxyCodeLine"><span class="doxyLineNumber">662</span><span class="doxyLineContent"></span></div><a id="l00663"></a><div class="doxyCodeLine"><span class="doxyLineNumber">663</span><span class="doxyLineContent"><span class="doxyHighlight">                    </span><span class="doxyHighlightComment">// Check if target reached</span></span></div><a id="l00664"></a><div class="doxyCodeLine"><span class="doxyLineNumber">664</span><span class="doxyLineContent"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ab2071bebba0c7833e95f725674c09661">_target_temperature_reached</a> &amp;&amp; std::abs(pid_input_err) &lt; 2.0f) {</span></span></div><a id="l00665"></a><div class="doxyCodeLine"><span class="doxyLineNumber">665</span><span class="doxyLineContent"><span class="doxyHighlight">                        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ab2071bebba0c7833e95f725674c09661">_target_temperature_reached</a>    = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></span></div><a id="l00666"></a><div class="doxyCodeLine"><span class="doxyLineNumber">666</span><span class="doxyLineContent"><span class="doxyHighlight">                        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac35d93cdbbeb533e8dbb76e21d42aff6">_target_temperature_reached_ms</a> = now;</span></span></div><a id="l00667"></a><div class="doxyCodeLine"><span class="doxyLineNumber">667</span><span class="doxyLineContent"><span class="doxyHighlight">                        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2b4634d628a0eef6045119de2f84e3f3">_last_activity_ms</a>              = now; </span><span class="doxyHighlightComment">// Reset activity on reaching target</span></span></div><a id="l00668"></a><div class="doxyCodeLine"><span class="doxyLineNumber">668</span><span class="doxyLineContent"><span class="doxyHighlight">                        <a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h/#ab62a3de8cc9e2daa50ddd66d65d4ab60">PICO_LOGI</a>(<a href="/desoldering-station-docs/docs/api/files/src/src/core/auto-tuner-cpp/#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, </span><span class="doxyHighlightStringLiteral">&quot;Target temperature %dÂ°C reached&quot;</span><span class="doxyHighlight">, <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#af97bc7ca209a3f52a72d22069d74b567">_target_temperature</a>);</span></span></div><a id="l00669"></a><div class="doxyCodeLine"><span class="doxyLineNumber">669</span><span class="doxyLineContent"><span class="doxyHighlight">                        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ab3c7390e2287b6afa9059d8ff80e960f">notifySetpointReached</a>(current_temp);</span></span></div><a id="l00670"></a><div class="doxyCodeLine"><span class="doxyLineNumber">670</span><span class="doxyLineContent"><span class="doxyHighlight">                    }</span></span></div><a id="l00671"></a><div class="doxyCodeLine"><span class="doxyLineNumber">671</span><span class="doxyLineContent"></span></div><a id="l00672"></a><div class="doxyCodeLine"><span class="doxyLineNumber">672</span><span class="doxyLineContent"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pid-h/#a6d11cf4eec697aa3ece607a2a5be27f4">pid_compute</a>(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2f1bfce01580ca2a2b5ff28dd494d956">_pid</a>, pid_input_err, &amp;pid_output) == PICO_OK) {</span></span></div><a id="l00673"></a><div class="doxyCodeLine"><span class="doxyLineNumber">673</span><span class="doxyLineContent"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">// Apply soft landing: limit max power when approaching setpoint</span></span></div><a id="l00674"></a><div class="doxyCodeLine"><span class="doxyLineNumber">674</span><span class="doxyLineContent"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight">&amp; sl = <a href="/desoldering-station-docs/docs/api/files/include/include/core/settings-h/#a27b7bb409185752994e0306746f43369">gSettings</a>.<a href="/desoldering-station-docs/docs/api/structs/settings-t/#afc8fbccf40cddd39208556394e375767">heater</a>.<a href="/desoldering-station-docs/docs/api/structs/heater-settings-t/#a4be448e55945cadaee6c7ca40b040b7f">soft_landing</a>;</span></span></div><a id="l00675"></a><div class="doxyCodeLine"><span class="doxyLineNumber">675</span><span class="doxyLineContent"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (sl.enabled &amp;&amp; pid_input_err &gt; 0 &amp;&amp; pid_input_err &lt; sl.threshold) {</span></span></div><a id="l00676"></a><div class="doxyCodeLine"><span class="doxyLineNumber">676</span><span class="doxyLineContent"><span class="doxyHighlight">                            </span><span class="doxyHighlightComment">// Scale power cap linearly from 100% at threshold to min_power_pct at setpoint</span></span></div><a id="l00677"></a><div class="doxyCodeLine"><span class="doxyLineNumber">677</span><span class="doxyLineContent"><span class="doxyHighlight">                            </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> scale = pid_input_err / </span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(sl.threshold);</span></span></div><a id="l00678"></a><div class="doxyCodeLine"><span class="doxyLineNumber">678</span><span class="doxyLineContent"><span class="doxyHighlight">                            </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> max_power = (sl.min_power_pct + (100.0f - sl.min_power_pct) * scale) / 100.0f;</span></span></div><a id="l00679"></a><div class="doxyCodeLine"><span class="doxyLineNumber">679</span><span class="doxyLineContent"><span class="doxyHighlight">                            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (pid_output &gt; max_power) {</span></span></div><a id="l00680"></a><div class="doxyCodeLine"><span class="doxyLineNumber">680</span><span class="doxyLineContent"><span class="doxyHighlight">                                pid_output = max_power;</span></span></div><a id="l00681"></a><div class="doxyCodeLine"><span class="doxyLineNumber">681</span><span class="doxyLineContent"><span class="doxyHighlight">                            }</span></span></div><a id="l00682"></a><div class="doxyCodeLine"><span class="doxyLineNumber">682</span><span class="doxyLineContent"><span class="doxyHighlight">                        }</span></span></div><a id="l00683"></a><div class="doxyCodeLine"><span class="doxyLineNumber">683</span><span class="doxyLineContent"><span class="doxyHighlight">                        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a96b732721b05b5cbb2d57d2a837ad64e">setPowerPercentF</a>(pid_output);</span></span></div><a id="l00684"></a><div class="doxyCodeLine"><span class="doxyLineNumber">684</span><span class="doxyLineContent"><span class="doxyHighlight">                    } </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> {</span></span></div><a id="l00685"></a><div class="doxyCodeLine"><span class="doxyLineNumber">685</span><span class="doxyLineContent"><span class="doxyHighlight">                        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac7f015d243f71fe84b7f203c714d7c6b">setPowerPercent</a>(0);</span></span></div><a id="l00686"></a><div class="doxyCodeLine"><span class="doxyLineNumber">686</span><span class="doxyLineContent"><span class="doxyHighlight">                    }</span></span></div><a id="l00687"></a><div class="doxyCodeLine"><span class="doxyLineNumber">687</span><span class="doxyLineContent"><span class="doxyHighlight">                } </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> {</span></span></div><a id="l00688"></a><div class="doxyCodeLine"><span class="doxyLineNumber">688</span><span class="doxyLineContent"><span class="doxyHighlight">                    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac7f015d243f71fe84b7f203c714d7c6b">setPowerPercent</a>(0);</span></span></div><a id="l00689"></a><div class="doxyCodeLine"><span class="doxyLineNumber">689</span><span class="doxyLineContent"><span class="doxyHighlight">                }</span></span></div><a id="l00690"></a><div class="doxyCodeLine"><span class="doxyLineNumber">690</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00691"></a><div class="doxyCodeLine"><span class="doxyLineNumber">691</span><span class="doxyLineContent"><span class="doxyHighlight">            }</span></span></div><a id="l00692"></a><div class="doxyCodeLine"><span class="doxyLineNumber">692</span><span class="doxyLineContent"></span></div><a id="l00693"></a><div class="doxyCodeLine"><span class="doxyLineNumber">693</span><span class="doxyLineContent"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da2dbec34a65724db94f81e8533ee18192">HeaterState::Standby</a>: {</span></span></div><a id="l00694"></a><div class="doxyCodeLine"><span class="doxyLineNumber">694</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightComment">// Check for sleep timeout (based on last activity)</span></span></div><a id="l00695"></a><div class="doxyCodeLine"><span class="doxyLineNumber">695</span><span class="doxyLineContent"><span class="doxyHighlight">                uint32_t idle_time = now - <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2b4634d628a0eef6045119de2f84e3f3">_last_activity_ms</a>;</span></span></div><a id="l00696"></a><div class="doxyCodeLine"><span class="doxyLineNumber">696</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (idle_time &gt; pdMS_TO_TICKS(<a href="/desoldering-station-docs/docs/api/files/include/include/core/settings-h/#a27b7bb409185752994e0306746f43369">gSettings</a>.<a href="/desoldering-station-docs/docs/api/structs/settings-t/#afc8fbccf40cddd39208556394e375767">heater</a>.<a href="/desoldering-station-docs/docs/api/structs/heater-settings-t/#afcfbaf12804b0a709663b4b6e34cd9c6">sleep_timeout_ms</a>)) {</span></span></div><a id="l00697"></a><div class="doxyCodeLine"><span class="doxyLineNumber">697</span><span class="doxyLineContent"><span class="doxyHighlight">                    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a1ac3cab3179638e6089e29ce9183edaa">_pending_state</a> = <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da243924bfd56a682be235638b53961e09">HeaterState::Sleep</a>;</span></span></div><a id="l00698"></a><div class="doxyCodeLine"><span class="doxyLineNumber">698</span><span class="doxyLineContent"><span class="doxyHighlight">                    <a href="/desoldering-station-docs/docs/api/files/include/include/core/pico-log-h/#ab62a3de8cc9e2daa50ddd66d65d4ab60">PICO_LOGI</a>(<a href="/desoldering-station-docs/docs/api/files/src/src/core/auto-tuner-cpp/#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, </span><span class="doxyHighlightStringLiteral">&quot;Sleep timeout, entering sleep&quot;</span><span class="doxyHighlight">);</span></span></div><a id="l00699"></a><div class="doxyCodeLine"><span class="doxyLineNumber">699</span><span class="doxyLineContent"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00700"></a><div class="doxyCodeLine"><span class="doxyLineNumber">700</span><span class="doxyLineContent"><span class="doxyHighlight">                }</span></span></div><a id="l00701"></a><div class="doxyCodeLine"><span class="doxyLineNumber">701</span><span class="doxyLineContent"></span></div><a id="l00702"></a><div class="doxyCodeLine"><span class="doxyLineNumber">702</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightComment">// PID control at standby temperature</span></span></div><a id="l00703"></a><div class="doxyCodeLine"><span class="doxyLineNumber">703</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#af97bc7ca209a3f52a72d22069d74b567">_target_temperature</a> &gt;= <a href="/desoldering-station-docs/docs/api/files/include/config-h/#aeadc03eab9d8beccd8909f4a85b7a614">CONFIG_MIN_SET_TEMP</a> &amp;&amp; current_temp &lt;= <a href="/desoldering-station-docs/docs/api/files/include/config-h/#a0bce3768ad4c423453cc46856a29ca1c">CONFIG_MAX_SET_TEMP</a>) {</span></span></div><a id="l00704"></a><div class="doxyCodeLine"><span class="doxyLineNumber">704</span><span class="doxyLineContent"><span class="doxyHighlight">                    pid_input_err = </span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#af97bc7ca209a3f52a72d22069d74b567">_target_temperature</a> - current_temp);</span></span></div><a id="l00705"></a><div class="doxyCodeLine"><span class="doxyLineNumber">705</span><span class="doxyLineContent"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/files/include/include/drivers/pid-h/#a6d11cf4eec697aa3ece607a2a5be27f4">pid_compute</a>(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a2f1bfce01580ca2a2b5ff28dd494d956">_pid</a>, pid_input_err, &amp;pid_output) == PICO_OK) {</span></span></div><a id="l00706"></a><div class="doxyCodeLine"><span class="doxyLineNumber">706</span><span class="doxyLineContent"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">// Apply soft landing in standby too</span></span></div><a id="l00707"></a><div class="doxyCodeLine"><span class="doxyLineNumber">707</span><span class="doxyLineContent"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight">&amp; sl = <a href="/desoldering-station-docs/docs/api/files/include/include/core/settings-h/#a27b7bb409185752994e0306746f43369">gSettings</a>.<a href="/desoldering-station-docs/docs/api/structs/settings-t/#afc8fbccf40cddd39208556394e375767">heater</a>.<a href="/desoldering-station-docs/docs/api/structs/heater-settings-t/#a4be448e55945cadaee6c7ca40b040b7f">soft_landing</a>;</span></span></div><a id="l00708"></a><div class="doxyCodeLine"><span class="doxyLineNumber">708</span><span class="doxyLineContent"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (sl.enabled &amp;&amp; pid_input_err &gt; 0 &amp;&amp; pid_input_err &lt; sl.threshold) {</span></span></div><a id="l00709"></a><div class="doxyCodeLine"><span class="doxyLineNumber">709</span><span class="doxyLineContent"><span class="doxyHighlight">                            </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> scale = pid_input_err / </span><span class="doxyHighlightKeyword">static_cast&lt;</span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(sl.threshold);</span></span></div><a id="l00710"></a><div class="doxyCodeLine"><span class="doxyLineNumber">710</span><span class="doxyLineContent"><span class="doxyHighlight">                            </span><span class="doxyHighlightKeywordType">float</span><span class="doxyHighlight"> max_power = (sl.min_power_pct + (100.0f - sl.min_power_pct) * scale) / 100.0f;</span></span></div><a id="l00711"></a><div class="doxyCodeLine"><span class="doxyLineNumber">711</span><span class="doxyLineContent"><span class="doxyHighlight">                            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (pid_output &gt; max_power) {</span></span></div><a id="l00712"></a><div class="doxyCodeLine"><span class="doxyLineNumber">712</span><span class="doxyLineContent"><span class="doxyHighlight">                                pid_output = max_power;</span></span></div><a id="l00713"></a><div class="doxyCodeLine"><span class="doxyLineNumber">713</span><span class="doxyLineContent"><span class="doxyHighlight">                            }</span></span></div><a id="l00714"></a><div class="doxyCodeLine"><span class="doxyLineNumber">714</span><span class="doxyLineContent"><span class="doxyHighlight">                        }</span></span></div><a id="l00715"></a><div class="doxyCodeLine"><span class="doxyLineNumber">715</span><span class="doxyLineContent"><span class="doxyHighlight">                        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a96b732721b05b5cbb2d57d2a837ad64e">setPowerPercentF</a>(pid_output);</span></span></div><a id="l00716"></a><div class="doxyCodeLine"><span class="doxyLineNumber">716</span><span class="doxyLineContent"><span class="doxyHighlight">                    } </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> {</span></span></div><a id="l00717"></a><div class="doxyCodeLine"><span class="doxyLineNumber">717</span><span class="doxyLineContent"><span class="doxyHighlight">                        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac7f015d243f71fe84b7f203c714d7c6b">setPowerPercent</a>(0);</span></span></div><a id="l00718"></a><div class="doxyCodeLine"><span class="doxyLineNumber">718</span><span class="doxyLineContent"><span class="doxyHighlight">                    }</span></span></div><a id="l00719"></a><div class="doxyCodeLine"><span class="doxyLineNumber">719</span><span class="doxyLineContent"><span class="doxyHighlight">                } </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> {</span></span></div><a id="l00720"></a><div class="doxyCodeLine"><span class="doxyLineNumber">720</span><span class="doxyLineContent"><span class="doxyHighlight">                    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac7f015d243f71fe84b7f203c714d7c6b">setPowerPercent</a>(0);</span></span></div><a id="l00721"></a><div class="doxyCodeLine"><span class="doxyLineNumber">721</span><span class="doxyLineContent"><span class="doxyHighlight">                }</span></span></div><a id="l00722"></a><div class="doxyCodeLine"><span class="doxyLineNumber">722</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00723"></a><div class="doxyCodeLine"><span class="doxyLineNumber">723</span><span class="doxyLineContent"><span class="doxyHighlight">            }</span></span></div><a id="l00724"></a><div class="doxyCodeLine"><span class="doxyLineNumber">724</span><span class="doxyLineContent"></span></div><a id="l00725"></a><div class="doxyCodeLine"><span class="doxyLineNumber">725</span><span class="doxyLineContent"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da902b0d55fddef6f8d651fe1035b7d4bd">HeaterState::Error</a>:</span></span></div><a id="l00726"></a><div class="doxyCodeLine"><span class="doxyLineNumber">726</span><span class="doxyLineContent"><span class="doxyHighlight">                <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac7f015d243f71fe84b7f203c714d7c6b">setPowerPercent</a>(0);</span></span></div><a id="l00727"></a><div class="doxyCodeLine"><span class="doxyLineNumber">727</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00728"></a><div class="doxyCodeLine"><span class="doxyLineNumber">728</span><span class="doxyLineContent"></span></div><a id="l00729"></a><div class="doxyCodeLine"><span class="doxyLineNumber">729</span><span class="doxyLineContent"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/desoldering-station-docs/docs/api/files/include/heater-h/#a09bbb9644b304079bea7823c2847d09da89dd2948ecda7325c0001d8a0e51a2d8">HeaterState::Tuning</a>:</span></span></div><a id="l00730"></a><div class="doxyCodeLine"><span class="doxyLineNumber">730</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightComment">// Auto-tune controls power output via relay feedback</span></span></div><a id="l00731"></a><div class="doxyCodeLine"><span class="doxyLineNumber">731</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/desoldering-station-docs/docs/api/files/include/include/core/auto-tuner-h/#a93692918a460a3b52ce705776651c0f5">auto_tune_is_running</a>()) {</span></span></div><a id="l00732"></a><div class="doxyCodeLine"><span class="doxyLineNumber">732</span><span class="doxyLineContent"><span class="doxyHighlight">                    uint8_t tune_power = <a href="/desoldering-station-docs/docs/api/files/include/include/core/auto-tuner-h/#a4e45392ff4aa4304006bf5694a76a5c6">auto_tune_update</a>(filtered_temp);</span></span></div><a id="l00733"></a><div class="doxyCodeLine"><span class="doxyLineNumber">733</span><span class="doxyLineContent"><span class="doxyHighlight">                    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac7f015d243f71fe84b7f203c714d7c6b">setPowerPercent</a>(tune_power);</span></span></div><a id="l00734"></a><div class="doxyCodeLine"><span class="doxyLineNumber">734</span><span class="doxyLineContent"><span class="doxyHighlight">                } </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> {</span></span></div><a id="l00735"></a><div class="doxyCodeLine"><span class="doxyLineNumber">735</span><span class="doxyLineContent"><span class="doxyHighlight">                    </span><span class="doxyHighlightComment">// Tuning finished or not running - stay safe</span></span></div><a id="l00736"></a><div class="doxyCodeLine"><span class="doxyLineNumber">736</span><span class="doxyLineContent"><span class="doxyHighlight">                    <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ac7f015d243f71fe84b7f203c714d7c6b">setPowerPercent</a>(0);</span></span></div><a id="l00737"></a><div class="doxyCodeLine"><span class="doxyLineNumber">737</span><span class="doxyLineContent"><span class="doxyHighlight">                }</span></span></div><a id="l00738"></a><div class="doxyCodeLine"><span class="doxyLineNumber">738</span><span class="doxyLineContent"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></span></div><a id="l00739"></a><div class="doxyCodeLine"><span class="doxyLineNumber">739</span><span class="doxyLineContent"><span class="doxyHighlight">        }</span></span></div><a id="l00740"></a><div class="doxyCodeLine"><span class="doxyLineNumber">740</span><span class="doxyLineContent"></span></div><a id="l00741"></a><div class="doxyCodeLine"><span class="doxyLineNumber">741</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Update PWM output</span></span></div><a id="l00742"></a><div class="doxyCodeLine"><span class="doxyLineNumber">742</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a45b5890f26e022432e617b0c48f780ca">setPWM</a>(<a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a68f7da74a214aa1f41ab4f191923addf">_output_power_pct</a>);</span></span></div><a id="l00743"></a><div class="doxyCodeLine"><span class="doxyLineNumber">743</span><span class="doxyLineContent"></span></div><a id="l00744"></a><div class="doxyCodeLine"><span class="doxyLineNumber">744</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Update pump</span></span></div><a id="l00745"></a><div class="doxyCodeLine"><span class="doxyLineNumber">745</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#aac2b597ae50e80fa44c8411082d9c793">_pump</a>-&gt;<a href="/desoldering-station-docs/docs/api/classes/pumpcontroller/#a29ec8dab28f0d3dad69288058d293efa">update</a>();</span></span></div><a id="l00746"></a><div class="doxyCodeLine"><span class="doxyLineNumber">746</span><span class="doxyLineContent"></span></div><a id="l00747"></a><div class="doxyCodeLine"><span class="doxyLineNumber">747</span><span class="doxyLineContent"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Store values for next iteration</span></span></div><a id="l00748"></a><div class="doxyCodeLine"><span class="doxyLineNumber">748</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#ad253b9665de45e09a932992303efe74b">_last_temp</a> = current_temp;</span></span></div><a id="l00749"></a><div class="doxyCodeLine"><span class="doxyLineNumber">749</span><span class="doxyLineContent"><span class="doxyHighlight">        <a href="/desoldering-station-docs/docs/api/classes/heatercontroller/#a7dfc74d0b9ffa2a5b9de0a9cf61ea512">_last_temp_check_ms</a> = now;</span></span></div><a id="l00750"></a><div class="doxyCodeLine"><span class="doxyLineNumber">750</span><span class="doxyLineContent"></span></div><a id="l00751"></a><div class="doxyCodeLine"><span class="doxyLineNumber">751</span><span class="doxyLineContent"><span class="doxyHighlight">        vTaskDelay(pdMS_TO_TICKS(100));</span></span></div><a id="l00752"></a><div class="doxyCodeLine"><span class="doxyLineNumber">752</span><span class="doxyLineContent"><span class="doxyHighlight">    }</span></span></div><a id="l00753"></a><div class="doxyCodeLine"><span class="doxyLineNumber">753</span><span class="doxyLineContent"><span class="doxyHighlight">}</span></span></div></div><hr><p class="doxyGeneratedBy">Generated via <a href="https://github.com/xpack/docusaurus-plugin-doxygen">docusaurus-plugin-doxygen</a> by <a href="https://www.doxygen.nl">Doxygen</a> 1.9.8<!-- -->.</p></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/desoldering-station-docs/docs/api/files/src/src/gui/lv-styles-cpp"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">lv_styles.cpp</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/desoldering-station-docs/docs/api/files/src/lv-port-cpp"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">lv_port.cpp</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#included-headers" class="table-of-contents__link toc-highlight">Included Headers</a></li><li><a href="#classes-index" class="table-of-contents__link toc-highlight">Classes Index</a></li><li><a href="#enumerations-index" class="table-of-contents__link toc-highlight">Enumerations Index</a></li><li><a href="#functions-index" class="table-of-contents__link toc-highlight">Functions Index</a></li><li><a href="#variables-index" class="table-of-contents__link toc-highlight">Variables Index</a></li><li><a href="#enumerations" class="table-of-contents__link toc-highlight">Enumerations</a><ul><li><a href="#a8dc2c250cb794c4483f1d66b87b1b25b" class="table-of-contents__link toc-highlight">enum class</a></li></ul></li><li><a href="#functions" class="table-of-contents__link toc-highlight">Functions</a><ul><li><a href="#a64e3c453aa85ff621214fa7b5f68ef20" class="table-of-contents__link toc-highlight">_heater_task()</a></li></ul></li><li><a href="#variables" class="table-of-contents__link toc-highlight">Variables</a><ul><li><a href="#a5a85b9c772bbeb480b209a3e6ea92b4c" class="table-of-contents__link toc-highlight">TAG</a></li></ul></li><li><a href="#file-listing" class="table-of-contents__link toc-highlight">File Listing</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/desoldering-station-docs/docs/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/desoldering-station-docs/docs/architecture">Architecture</a></li><li class="footer__item"><a class="footer__link-item" href="/desoldering-station-docs/docs/api">API Reference</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Guides</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/desoldering-station-docs/docs/category/drivers">Drivers</a></li><li class="footer__item"><a class="footer__link-item" href="/desoldering-station-docs/docs/category/controllers">Controllers</a></li><li class="footer__item"><a class="footer__link-item" href="/desoldering-station-docs/docs/category/gui">GUI</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/desoldering-station-docs/blog">Updates</a></li><li class="footer__item"><a href="https://github.com/maciekr1234/desoldering-station" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2025 Desoldering Station Project. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>